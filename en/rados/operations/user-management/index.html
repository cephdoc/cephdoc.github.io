
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User Management &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../../../" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../">Ceph Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="user-management">
<h1>User Management<a class="headerlink" href="#user-management" title="Permalink to this headline">¶</a></h1>
<p>This document describes <a class="reference internal" href="../../../../glossary/#term-ceph-client"><em class="xref std std-term">Ceph Client</em></a> users, and their authentication and
authorization with the <a class="reference internal" href="../../../../glossary/#term-ceph-storage-cluster"><em class="xref std std-term">Ceph Storage Cluster</em></a>. Users are either
individuals or system actors such as applications, which use Ceph clients to
interact with the Ceph Storage Cluster daemons.</p>
<p class="ditaa">
<img src="../../../../_images/ditaa-4e41c1197cfd86b7f36a128297660e48903315d1.png"/>
</p>
<p>When Ceph runs with authentication and authorization enabled (enabled by
default), you must specify a user name and a keyring containing the secret key
of the specified user (usually via the command line). If you do not specify a
user name, Ceph will use <tt class="docutils literal"><span class="pre">client.admin</span></tt> as the default user name. If you do
not specify a keyring, Ceph will look for a keyring via the <tt class="docutils literal"><span class="pre">keyring</span></tt> setting
in the Ceph configuration. For example, if you execute the <tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">health</span></tt>
command without specifying a user or keyring:</p>
<div class="highlight-python"><pre>ceph health</pre>
</div>
<p>Ceph interprets the command like this:</p>
<div class="highlight-python"><pre>ceph -n client.admin --keyring=/etc/ceph/ceph.client.admin.keyring health</pre>
</div>
<p>Alternatively, you may use the <tt class="docutils literal"><span class="pre">CEPH_ARGS</span></tt> environment variable to avoid
re-entry of the user name and secret.</p>
<p>For details on configuring the Ceph Storage Cluster to use authentication,
see <a class="reference external" href="../../configuration/auth-config-ref">Cephx Config Reference</a>. For details on the architecture of Cephx, see
<a class="reference external" href="../../../architecture#high-availability-authentication">Architecture - High Availability Authentication</a>.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Irrespective of the type of Ceph client (e.g., Block Device, Object Storage,
Filesystem, native API, etc.), Ceph stores all data as objects within <a class="reference external" href="../pools">pools</a>.
Ceph users must have access to pools in order to read and write data.
Additionally, Ceph users must have execute permissions to use Ceph&#8217;s
administrative commands. The following concepts will help you understand Ceph
user management.</p>
<div class="section" id="user">
<h3>User<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h3>
<p>A user is either an individual or a system actor such as an application.
Creating users allows you to control who (or what) can access your Ceph Storage
Cluster, its pools, and the data within pools.</p>
<p>Ceph has the notion of a <tt class="docutils literal"><span class="pre">type</span></tt> of user. For the purposes of user management,
the type will always be <tt class="docutils literal"><span class="pre">client</span></tt>. Ceph identifies users in period (.)
delimited form consisting of the user type and the user ID: for example,
<tt class="docutils literal"><span class="pre">TYPE.ID</span></tt>, <tt class="docutils literal"><span class="pre">client.admin</span></tt>, or <tt class="docutils literal"><span class="pre">client.user1</span></tt>. The reason for user typing
is that Ceph Monitors, OSDs, and Metadata Servers also use the Cephx protocol,
but they are not clients. Distinguishing the user type helps to distinguish
between client users and other users&#8211;streamlining access control, user
monitoring and traceability.</p>
<p>Sometimes Ceph&#8217;s user type may seem confusing, because the Ceph command line
allows you to specify a user with or without the type, depending upon your
command line usage. If you specify <tt class="docutils literal"><span class="pre">--user</span></tt> or <tt class="docutils literal"><span class="pre">--id</span></tt>, you can omit the
type. So <tt class="docutils literal"><span class="pre">client.user1</span></tt> can be entered simply as <tt class="docutils literal"><span class="pre">user1</span></tt>. If you specify
<tt class="docutils literal"><span class="pre">--name</span></tt> or <tt class="docutils literal"><span class="pre">-n</span></tt>, you must specify the type and name, such as
<tt class="docutils literal"><span class="pre">client.user1</span></tt>. We recommend using the type and name as a best practice
wherever possible.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A Ceph Storage Cluster user is not the same as a Ceph Object Storage
user or a Ceph Filesystem user. The Ceph Object Gateway uses a Ceph Storage
Cluster user to communicate between the gateway daemon and the storage
cluster, but the gateway has its own user management functionality for end
users. The Ceph Filesystem uses POSIX semantics. The user space associated
with the Ceph Filesystem is not the same as a Ceph Storage Cluster user.</p>
</div>
</div>
<div class="section" id="authorization-capabilities">
<h3>Authorization (Capabilities)<a class="headerlink" href="#authorization-capabilities" title="Permalink to this headline">¶</a></h3>
<p>Ceph uses the term &#8220;capabilities&#8221; (caps) to describe authorizing an
authenticated user to exercise the functionality of the monitors, OSDs and
metadata servers. Capabilities can also restrict access to data within a pool or
a namespace within a pool. A Ceph administrative user sets a user&#8217;s
capabilities when creating or updating a user.</p>
<p>Capability syntax follows the form:</p>
<div class="highlight-python"><pre>{daemon-type} 'allow {capability}' [{daemon-type} 'allow {capability}']</pre>
</div>
<ul>
<li><p class="first"><strong>Monitor Caps:</strong> Monitor capabilities include <tt class="docutils literal"><span class="pre">r</span></tt>, <tt class="docutils literal"><span class="pre">w</span></tt>, <tt class="docutils literal"><span class="pre">x</span></tt> and
<tt class="docutils literal"><span class="pre">allow</span> <span class="pre">profile</span> <span class="pre">{cap}</span></tt>. For example:</p>
<div class="highlight-python"><pre>mon 'allow rwx`
mon 'allow profile osd'</pre>
</div>
</li>
<li><p class="first"><strong>OSD Caps:</strong> OSD capabilities include <tt class="docutils literal"><span class="pre">r</span></tt>, <tt class="docutils literal"><span class="pre">w</span></tt>, <tt class="docutils literal"><span class="pre">x</span></tt>, <tt class="docutils literal"><span class="pre">class-read</span></tt>,
<tt class="docutils literal"><span class="pre">class-write</span></tt> and <tt class="docutils literal"><span class="pre">profile</span> <span class="pre">osd</span></tt>. Additionally, OSD capabilities also
allow for pool and namespace settings.</p>
<div class="highlight-python"><pre>osd 'allow {capability}' [pool={poolname}] [namespace={namespace-name}]</pre>
</div>
</li>
<li><p class="first"><strong>Metadata Server Caps:</strong> Metadata server capability simply requires <tt class="docutils literal"><span class="pre">allow</span></tt>,
or blank and does not parse anything further.</p>
<div class="highlight-python"><pre>mds 'allow'</pre>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Ceph Object Gateway daemon (<tt class="docutils literal"><span class="pre">radosgw</span></tt>) is a client of the
Ceph Storage Cluster, so it isn&#8217;t represented as a Ceph Storage
Cluster daemon type.</p>
</div>
<p>The following entries describe each capability.</p>
<p><tt class="docutils literal"><span class="pre">allow</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Precedes access settings for a daemon. Implies <tt class="docutils literal"><span class="pre">rw</span></tt>
for MDS only.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">r</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives the user read access. Required with monitors to retrieve
the CRUSH map.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">w</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives the user write access to objects.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">x</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives the user the capability to call class methods
(i.e., both read and write) and to conduct <tt class="docutils literal"><span class="pre">auth</span></tt>
operations on monitors.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">class-read</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Descriptions:</th><td class="field-body">Gives the user the capability to call class read methods.
Subset of <tt class="docutils literal"><span class="pre">x</span></tt>.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">class-write</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives the user the capability to call class write methods.
Subset of <tt class="docutils literal"><span class="pre">x</span></tt>.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">*</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives the user read, write and execute permissions for a
particular daemon/pool, and the ability to execute
admin commands.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">profile</span> <span class="pre">osd</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives a user permissions to connect as an OSD to other OSDs or
monitors. Conferred on OSDs to enable OSDs to handle replication
heartbeat traffic and status reporting.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">profile</span> <span class="pre">mds</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives a user permissions to connect as a MDS to other MDSs or
monitors.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">profile</span> <span class="pre">bootstrap-osd</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives a user permissions to bootstrap an OSD. Conferred on
deployment tools such as <tt class="docutils literal"><span class="pre">ceph-disk</span></tt>, <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt>, etc.
so that they have permissions to add keys, etc. when
bootstrapping an OSD.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">profile</span> <span class="pre">bootstrap-mds</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Gives a user permissions to bootstrap a metadata server.
Conferred on deployment tools such as <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt>, etc.
so they have permissions to add keys, etc. when bootstrapping
a metadata server.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pool">
<h3>Pool<a class="headerlink" href="#pool" title="Permalink to this headline">¶</a></h3>
<p>A pool is a logical partition where users store data. By default, a Ceph Storage
Cluster has <a class="reference external" href="../pools">pools</a> for <tt class="docutils literal"><span class="pre">data</span></tt>, <tt class="docutils literal"><span class="pre">rbd</span></tt> and <tt class="docutils literal"><span class="pre">metadata</span></tt> (metadata server).
In Ceph deployments, it is common to create a pool as a logical partition for
similar types of data. For example, when deploying Ceph as a backend for
OpenStack, a typical deployment would have pools for volumes, images, backups
and virtual machines, and users such as <tt class="docutils literal"><span class="pre">client.glance</span></tt>, <tt class="docutils literal"><span class="pre">client.cinder</span></tt>,
etc.</p>
</div>
<div class="section" id="namespace">
<h3>Namespace<a class="headerlink" href="#namespace" title="Permalink to this headline">¶</a></h3>
<p>Objects within a pool can be associated to a namespace&#8211;a logical group of
objects within the pool. A user&#8217;s access to a pool can be associated with a
namespace such that reads and writes by the user take place only within the
namespace. Objects written to a namespace within the pool can only be accessed
by users who have access to the namespace.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently (i.e., <tt class="docutils literal"><span class="pre">firefly</span></tt>), namespaces are only useful for
applications written on top of <tt class="docutils literal"><span class="pre">librados</span></tt>. Ceph clients such as block
device, object storage and file system do not currently support this
feature.</p>
</div>
<p>The rationale for namespaces is that pools can be a computationally expensive
method of segregating data sets for the purposes of authorizing separate sets
of users. For example, a pool should have ~100 placement groups per OSD. So an
exemplary cluster with 1000 OSDs would have 100,000 placement groups for one
pool. Each pool would create another 100,000 placement groups in the exemplary
cluster. By contrast, writing an object to a namespace simply associates the
namespace to the object name with out the computational overhead of a separate
pool. Rather than creating a separate pool for a user or set of users, you may
use a namespace. <strong>Note:</strong> Only available using <tt class="docutils literal"><span class="pre">librados</span></tt> at this time.</p>
</div>
</div>
<div class="section" id="managing-users">
<h2>Managing Users<a class="headerlink" href="#managing-users" title="Permalink to this headline">¶</a></h2>
<p>User management functionality provides Ceph Storage Cluster administrators with
the ability to create, update and delete users directly in the Ceph Storage
Cluster.</p>
<p>When you create or delete users in the Ceph Storage Cluster, you may need to
distribute keys to clients so that they can be added to keyrings. See <a class="reference internal" href="#keyring-management">Keyring
Management</a> for details.</p>
<div class="section" id="list-users">
<h3>List Users<a class="headerlink" href="#list-users" title="Permalink to this headline">¶</a></h3>
<p>To list the users in your cluster, execute the following:</p>
<div class="highlight-python"><pre>ceph auth list</pre>
</div>
<p>Ceph will list out all users in your cluster. For example, in a two-node
exemplary cluster, <tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">list</span></tt> will output something that looks like
this:</p>
<div class="highlight-python"><pre>installed auth entries:

osd.0
        key: AQCvCbtToC6MDhAATtuT70Sl+DymPCfDSsyV4w==
        caps: [mon] allow profile osd
        caps: [osd] allow *
osd.1
        key: AQC4CbtTCFJBChAAVq5spj0ff4eHZICxIOVZeA==
        caps: [mon] allow profile osd
        caps: [osd] allow *
client.admin
        key: AQBHCbtT6APDHhAA5W00cBchwkQjh3dkKsyPjw==
        caps: [mds] allow
        caps: [mon] allow *
        caps: [osd] allow *
client.bootstrap-mds
        key: AQBICbtTOK9uGBAAdbe5zcIGHZL3T/u2g6EBww==
        caps: [mon] allow profile bootstrap-mds
client.bootstrap-osd
        key: AQBHCbtT4GxqORAADE5u7RkpCN/oo4e5W0uBtw==
        caps: [mon] allow profile bootstrap-osd</pre>
</div>
<p>Note that the <tt class="docutils literal"><span class="pre">TYPE.ID</span></tt> notation for users applies such that <tt class="docutils literal"><span class="pre">osd.0</span></tt> is a
user of type <tt class="docutils literal"><span class="pre">osd</span></tt> and its ID is <tt class="docutils literal"><span class="pre">0</span></tt>, <tt class="docutils literal"><span class="pre">client.admin</span></tt> is a user of type
<tt class="docutils literal"><span class="pre">client</span></tt> and its ID is <tt class="docutils literal"><span class="pre">admin</span></tt> (i.e., the default <tt class="docutils literal"><span class="pre">client.admin</span></tt> user).
Note also that each entry has a <tt class="docutils literal"><span class="pre">key:</span> <span class="pre">&lt;value&gt;</span></tt> entry, and one or more
<tt class="docutils literal"><span class="pre">caps:</span></tt> entries.</p>
<p>You may use the <tt class="docutils literal"><span class="pre">-o</span> <span class="pre">{filename}</span></tt> option with <tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">list</span></tt> to
save the output to a file.</p>
</div>
<div class="section" id="get-a-user">
<h3>Get a User<a class="headerlink" href="#get-a-user" title="Permalink to this headline">¶</a></h3>
<p>To retrieve a specific user, key and capabilities, execute the
following:</p>
<div class="highlight-python"><pre>ceph auth get {TYPE.ID}</pre>
</div>
<p>For example:</p>
<div class="highlight-python"><pre>ceph auth get client.admin</pre>
</div>
<p>You may also use the <tt class="docutils literal"><span class="pre">-o</span> <span class="pre">{filename}</span></tt> option with <tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">get</span></tt> to
save the output to a file. Developers may also execute the following:</p>
<div class="highlight-python"><pre>ceph auth export {TYPE.ID}</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">auth</span> <span class="pre">export</span></tt> command is identical to <tt class="docutils literal"><span class="pre">auth</span> <span class="pre">get</span></tt>, but also prints
out the internal <tt class="docutils literal"><span class="pre">auid</span></tt>, which isn&#8217;t relevant to end users.</p>
</div>
<div class="section" id="add-a-user">
<h3>Add a User<a class="headerlink" href="#add-a-user" title="Permalink to this headline">¶</a></h3>
<p>Adding a user creates a username (i.e., <tt class="docutils literal"><span class="pre">TYPE.ID</span></tt>), a secret key and
any capabilities included in the command you use to create the user.</p>
<p>A user&#8217;s key enables the user to authenticate with the Ceph Storage Cluster.
The user&#8217;s capabilities authorize the user to read, write, or execute on Ceph
monitors (<tt class="docutils literal"><span class="pre">mon</span></tt>), Ceph OSDs (<tt class="docutils literal"><span class="pre">osd</span></tt>) or Ceph Metadata  Servers (<tt class="docutils literal"><span class="pre">mds</span></tt>).</p>
<p>There are a few ways to add a user:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">add</span></tt>: This command is the canonical way to add a user. It
will create the user, generate a key and add any specified capabilities.</li>
<li><tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">get-or-create</span></tt>: This command is often the most convenient way
to create a user, because it returns a keyfile format with the user name
(in brackets) and the key. If the user already exists, this command
simply returns the user name and key in the keyfile format. You may use the
<tt class="docutils literal"><span class="pre">-o</span> <span class="pre">{filename}</span></tt> option to save the output to a file.</li>
<li><tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">get-or-create-key</span></tt>: This command is a convenient way to create
a user and return the user&#8217;s key (only). This is useful for clients that
need the key only (e.g., libvirt). If the user already exists, this command
simply returns the key. You may use the <tt class="docutils literal"><span class="pre">-o</span> <span class="pre">{filename}</span></tt> option to save the
output to a file.</li>
</ul>
<p>When creating client users, you may create a user with no capabilities. A user
with no capabilities is useless beyond mere authentication, because the client
cannot retrieve the cluster map from the monitor. However, you can create a
user with no capabilities if you wish to defer adding capabilities later using
the <tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">caps</span></tt> command.</p>
<p>A typical user has at least read capabilities on the Ceph monitor and
read and write capability on Ceph OSDs. Additionally, a user&#8217;s OSD permissions
are often restricted to accessing a particular pool.</p>
<div class="highlight-python"><pre>ceph auth add client.john mon 'allow r' osd 'allow rw pool=liverpool'
ceph auth get-or-create client.paul mon 'allow r' osd 'allow rw pool=liverpool'
ceph auth get-or-create client.george mon 'allow r' osd 'allow rw pool=liverpool' -o george.keyring
ceph auth get-or-create-key client.ringo mon 'allow r' osd 'allow rw pool=liverpool' -o ringo.key</pre>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">If you provide a user with capabilities to OSDs, but you DO NOT
restrict access to particular pools, the user will have access to ALL
pools in the cluster!</p>
</div>
</div>
<div class="section" id="modify-user-capabilities">
<h3>Modify User Capabilities<a class="headerlink" href="#modify-user-capabilities" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">caps</span></tt> command allows you to specify a user and change the
user&#8217;s capabilties. To add capabilities, use the form:</p>
<div class="highlight-python"><pre>ceph auth caps USERTYPE.USERID {daemon} 'allow [r|w|x|*|...] [pool={pool-name}] [namespace={namespace-name}'</pre>
</div>
<p>For example:</p>
<div class="highlight-python"><pre>ceph auth caps client.john mon 'allow r' osd 'allow rw pool=liverpool'
ceph auth caps client.paul mon 'allow rw' osd 'allow rwx pool=liverpool'
ceph auth caps client.brian-manager mon 'allow *' osd 'allow *'</pre>
</div>
<p>To remove a capability, you may reset the capability. If you want the user
to have no access to a particular daemon that was previously set, specify
an empty string. For example:</p>
<div class="highlight-python"><pre>ceph auth caps client.ringo mon ' ' osd ' '</pre>
</div>
<p>See <a class="reference internal" href="#authorization-capabilities">Authorization (Capabilities)</a> for additional details on capabilities.</p>
</div>
<div class="section" id="delete-a-user">
<h3>Delete a User<a class="headerlink" href="#delete-a-user" title="Permalink to this headline">¶</a></h3>
<p>To delete a user, use <tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">del</span></tt>:</p>
<div class="highlight-python"><pre>ceph auth del {TYPE}.{ID}</pre>
</div>
<p>Where <tt class="docutils literal"><span class="pre">{TYPE}</span></tt> is one of <tt class="docutils literal"><span class="pre">client</span></tt>, <tt class="docutils literal"><span class="pre">osd</span></tt>, <tt class="docutils literal"><span class="pre">mon</span></tt>, or <tt class="docutils literal"><span class="pre">mds</span></tt>,
and <tt class="docutils literal"><span class="pre">{ID}</span></tt> is the user name or ID of the daemon.</p>
</div>
<div class="section" id="print-a-user-s-key">
<h3>Print a User&#8217;s Key<a class="headerlink" href="#print-a-user-s-key" title="Permalink to this headline">¶</a></h3>
<p>To print a user&#8217;s authentication key to standard output, execute the following:</p>
<div class="highlight-python"><pre>ceph auth print-key {TYPE}.{ID}</pre>
</div>
<p>Where <tt class="docutils literal"><span class="pre">{TYPE}</span></tt> is one of <tt class="docutils literal"><span class="pre">client</span></tt>, <tt class="docutils literal"><span class="pre">osd</span></tt>, <tt class="docutils literal"><span class="pre">mon</span></tt>, or <tt class="docutils literal"><span class="pre">mds</span></tt>,
and <tt class="docutils literal"><span class="pre">{ID}</span></tt> is the user name or ID of the daemon.</p>
<p>Printing a user&#8217;s key is useful when you need to populate client
software with a user&#8217;s key  (e.g., libvirt).</p>
<div class="highlight-python"><pre>mount -t ceph serverhost:/ mountpoint -o name=client.user,secret=`ceph auth print-key client.user`</pre>
</div>
</div>
<div class="section" id="import-a-user-s">
<h3>Import a User(s)<a class="headerlink" href="#import-a-user-s" title="Permalink to this headline">¶</a></h3>
<p>To import one or more users, use <tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">import</span></tt> and
specify a keyring:</p>
<div class="highlight-python"><pre>ceph auth import -i /path/to/keyring</pre>
</div>
<p>For example:</p>
<div class="highlight-python"><pre>sudo ceph auth import -i /etc/ceph/ceph.keyring</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ceph storage cluster will add new users, their keys and their
capabilities and will update existing users, their keys and their
capabilities.</p>
</div>
</div>
</div>
<div class="section" id="keyring-management">
<h2>Keyring Management<a class="headerlink" href="#keyring-management" title="Permalink to this headline">¶</a></h2>
<p>When you access Ceph via a Ceph client, the Ceph client will look for a local
keyring. Ceph presets the <tt class="docutils literal"><span class="pre">keyring</span></tt> setting with the following four keyring
names by default so you don&#8217;t have to set them in your Ceph configuration file
unless you want to override the defaults (not recommended):</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">/etc/ceph/$cluster.$name.keyring</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/etc/ceph/$cluster.keyring</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/etc/ceph/keyring</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/etc/ceph/keyring.bin</span></tt></li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">$cluster</span></tt> metavariable is your Ceph cluster name as defined by the
name of the Ceph configuration file (i.e., <tt class="docutils literal"><span class="pre">ceph.conf</span></tt> means the cluster name
is <tt class="docutils literal"><span class="pre">ceph</span></tt>; thus, <tt class="docutils literal"><span class="pre">ceph.keyring</span></tt>). The <tt class="docutils literal"><span class="pre">$name</span></tt> metavariable is the user
type and user ID (e.g., <tt class="docutils literal"><span class="pre">client.admin</span></tt>; thus, <tt class="docutils literal"><span class="pre">ceph.client.admin.keyring</span></tt>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When executing commands that read or write to <tt class="docutils literal"><span class="pre">/etc/ceph</span></tt>, you may
need to use <tt class="docutils literal"><span class="pre">sudo</span></tt> to execute the command as <tt class="docutils literal"><span class="pre">root</span></tt>.</p>
</div>
<p>After you create a user (e.g., <tt class="docutils literal"><span class="pre">client.ringo</span></tt>), you must get the key and add
it to a keyring on a Ceph client so that the user can access the Ceph Storage
Cluster.</p>
<p>The <a class="reference internal" href="#user-management">User Management</a> section details how to list, get, add, modify and delete
users directly in the Ceph Storage Cluster. However, Ceph also provides the
<tt class="docutils literal"><span class="pre">ceph-authtool</span></tt> utility to allow you to manage keyrings from a Ceph client.</p>
<div class="section" id="create-a-keyring">
<h3>Create a Keyring<a class="headerlink" href="#create-a-keyring" title="Permalink to this headline">¶</a></h3>
<p>When you use the procedures in the <a class="reference internal" href="#managing-users">Managing Users</a> section to create users,
you need to provide user keys to the Ceph client(s) so that the Ceph client
can retrieve the key for the specified user and authenticate with the Ceph
Storage Cluster. Ceph Clients access keyrings to lookup a user name and
retrieve the user&#8217;s key.</p>
<p>The <tt class="docutils literal"><span class="pre">ceph-authtool</span></tt> utility allows you to create a keyring. To create an
empty keyring, use <tt class="docutils literal"><span class="pre">--create-keyring</span></tt> or <tt class="docutils literal"><span class="pre">-C</span></tt>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ceph</span><span class="o">-</span><span class="n">authtool</span> <span class="o">--</span><span class="n">create</span><span class="o">-</span><span class="n">keyring</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">keyring</span>
</pre></div>
</div>
<p>When creating a keyring with multiple users, we recommend using the cluster name
(e.g., <tt class="docutils literal"><span class="pre">$cluster.keyring</span></tt>) for the keyring filename and saving it in the
<tt class="docutils literal"><span class="pre">/etc/ceph</span></tt> directory so that the <tt class="docutils literal"><span class="pre">keyring</span></tt> configuration default setting
will pick up the filename without requiring you to specify it in the local copy
of your Ceph configuration file. For example, create <tt class="docutils literal"><span class="pre">ceph.keyring</span></tt> by
executing the following:</p>
<div class="highlight-python"><pre>sudo ceph-authtool -C /etc/ceph/ceph.keyring</pre>
</div>
<p>When creating a keyring with a single user, we recommend using the cluster name,
the user type and the user name and saving it in the <tt class="docutils literal"><span class="pre">/etc/ceph</span></tt> directory.
For example, <tt class="docutils literal"><span class="pre">ceph.client.admin.keyring</span></tt> for the <tt class="docutils literal"><span class="pre">client.admin</span></tt> user.</p>
<p>To create a keyring in <tt class="docutils literal"><span class="pre">/etc/ceph</span></tt>, you must do so as <tt class="docutils literal"><span class="pre">root</span></tt>. This means
the file will have <tt class="docutils literal"><span class="pre">rw</span></tt> permissions for the <tt class="docutils literal"><span class="pre">root</span></tt> user only, which is
appropriate when the keyring contains administrator keys. However, if you
intend to use the keyring for a particular user or group of users, ensure
that you execute <tt class="docutils literal"><span class="pre">chown</span></tt> or <tt class="docutils literal"><span class="pre">chmod</span></tt> to establish appropriate keyring
ownership and access.</p>
</div>
<div class="section" id="add-a-user-to-a-keyring">
<h3>Add a User to a Keyring<a class="headerlink" href="#add-a-user-to-a-keyring" title="Permalink to this headline">¶</a></h3>
<p>When you  <a class="reference internal" href="#add-a-user">Add a User</a> to the Ceph Storage Cluster, you can use the <a class="reference internal" href="#get-a-user">Get a
User</a> procedure to retrieve a user, key and capabilities and save the user to a
keyring.</p>
<p>When you only want to use one user per keyring, the <a class="reference internal" href="#get-a-user">Get a User</a> procedure with
the <tt class="docutils literal"><span class="pre">-o</span></tt> option will save the output in the keyring file format. For example,
to create a keyring for the <tt class="docutils literal"><span class="pre">client.admin</span></tt> user, execute the following:</p>
<div class="highlight-python"><pre>sudo ceph auth get client.admin -o /etc/ceph/ceph.client.admin.keyring</pre>
</div>
<p>Notice that we use the recommended file format for an individual user.</p>
<p>When you want to import users to a keyring, you can use <tt class="docutils literal"><span class="pre">ceph-authtool</span></tt>
to specify the destination keyring and the source keyring.
For example:</p>
<div class="highlight-python"><pre>sudo ceph-authtool /etc/ceph/ceph.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring</pre>
</div>
</div>
<div class="section" id="create-a-user">
<h3>Create a User<a class="headerlink" href="#create-a-user" title="Permalink to this headline">¶</a></h3>
<p>Ceph provides the <a class="reference internal" href="#add-a-user">Add a User</a> function to create a user directly in the Ceph
Storage Cluster. However, you can also create a user, keys and capabilities
directly on a Ceph client keyring. Then, you can import the user to the Ceph
Storage Cluster. For example:</p>
<div class="highlight-python"><pre>sudo ceph-authtool -n client.ringo --cap osd 'allow rwx' --cap mon 'allow rwx' /etc/ceph/ceph.keyring</pre>
</div>
<p>See <a class="reference internal" href="#authorization-capabilities">Authorization (Capabilities)</a> for additional details on capabilities.</p>
<p>You can also create a keyring and add a new user to the keyring simultaneously.
For example:</p>
<div class="highlight-python"><pre>sudo ceph-authtool -C /etc/ceph/ceph.keyring -n client.ringo --cap osd 'allow rwx' --cap mon 'allow rwx' --gen-key</pre>
</div>
<p>In the foregoing scenarios, the new user <tt class="docutils literal"><span class="pre">client.ringo</span></tt> is only in the
keyring. To add the new user to the Ceph Storage Cluster, you must still add
the new user to the Ceph Storage Cluster.</p>
<div class="highlight-python"><pre>sudo ceph auth add client.ringo -i /etc/ceph/ceph.keyring</pre>
</div>
</div>
<div class="section" id="modify-a-user">
<h3>Modify a User<a class="headerlink" href="#modify-a-user" title="Permalink to this headline">¶</a></h3>
<p>To modify the capabilities of a user record in a keyring, specify the keyring,
and the user followed by the capabilities. For example:</p>
<div class="highlight-python"><pre>sudo ceph-authtool /etc/ceph/ceph.keyring -n client.ringo --cap osd 'allow rwx' --cap mon 'allow rwx'</pre>
</div>
<p>To update the user to the Ceph Storage Cluster, you must update the user
in the keyring to the user entry in the the Ceph Storage Cluster.</p>
<div class="highlight-python"><pre>sudo ceph auth import -i /etc/ceph/ceph.keyring</pre>
</div>
<p>See <a class="reference internal" href="#import-a-user-s">Import a User(s)</a> for details on updating a Ceph Storage Cluster user
from a keyring.</p>
<p>You may also <a class="reference internal" href="#modify-user-capabilities">Modify User Capabilities</a> directly in the cluster, store the
results to a keyring file; then, import the keyring into your main
<tt class="docutils literal"><span class="pre">ceph.keyring</span></tt> file.</p>
</div>
</div>
<div class="section" id="command-line-usage">
<h2>Command Line Usage<a class="headerlink" href="#command-line-usage" title="Permalink to this headline">¶</a></h2>
<p>Ceph supports the following usage for user name and secret:</p>
<p><tt class="docutils literal"><span class="pre">--id</span></tt> | <tt class="docutils literal"><span class="pre">--user</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body"><p class="first">Ceph identifies users with a type and an ID (e.g., <tt class="docutils literal"><span class="pre">TYPE.ID</span></tt> or
<tt class="docutils literal"><span class="pre">client.admin</span></tt>, <tt class="docutils literal"><span class="pre">client.user1</span></tt>). The <tt class="docutils literal"><span class="pre">id</span></tt>, <tt class="docutils literal"><span class="pre">name</span></tt> and
<tt class="docutils literal"><span class="pre">-n</span></tt> options enable you to specify the ID portion of the user
name (e.g., <tt class="docutils literal"><span class="pre">admin</span></tt>, <tt class="docutils literal"><span class="pre">user1</span></tt>, <tt class="docutils literal"><span class="pre">foo</span></tt>, etc.). You can specify
the user with the <tt class="docutils literal"><span class="pre">--id</span></tt> and omit the type. For example,
to specify user <tt class="docutils literal"><span class="pre">client.foo</span></tt> enter the following:</p>
<div class="last highlight-python"><pre>ceph --id foo --keyring /path/to/keyring health
ceph --user foo --keyring /path/to/keyring health</pre>
</div>
</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">--name</span></tt> | <tt class="docutils literal"><span class="pre">-n</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body"><p class="first">Ceph identifies users with a type and an ID (e.g., <tt class="docutils literal"><span class="pre">TYPE.ID</span></tt> or
<tt class="docutils literal"><span class="pre">client.admin</span></tt>, <tt class="docutils literal"><span class="pre">client.user1</span></tt>). The <tt class="docutils literal"><span class="pre">--name</span></tt> and <tt class="docutils literal"><span class="pre">-n</span></tt>
options enables you to specify the fully qualified user name.
You must specify the user type (typically <tt class="docutils literal"><span class="pre">client</span></tt>) with the
user ID. For example:</p>
<div class="last highlight-python"><pre>ceph --name client.foo --keyring /path/to/keyring health
ceph -n client.foo --keyring /path/to/keyring health</pre>
</div>
</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">--keyring</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body"><p class="first">The path to the keyring containing one or more user name and
secret. The <tt class="docutils literal"><span class="pre">--secret</span></tt> option provides the same functionality,
but it does not work with Ceph RADOS Gateway, which uses
<tt class="docutils literal"><span class="pre">--secret</span></tt> for another purpose. You may retrieve a keyring with
<tt class="docutils literal"><span class="pre">ceph</span> <span class="pre">auth</span> <span class="pre">get-or-create</span></tt> and store it locally. This is a
preferred approach, because you can switch user names without
switching the keyring path. For example:</p>
<div class="last highlight-python"><pre>sudo rbd map foo --pool rbd myimage --id client.foo --keyring /path/to/keyring</pre>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">cephx</span></tt> protocol authenticates Ceph clients and servers to each other.  It
is not intended to handle authentication of human users or application programs
run on their behalf.  If that effect is required to handle your access control
needs, you must have another mechanism, which is likely to be specific to the
front end used to access the Ceph object store.  This other mechanism has the
role of ensuring that only acceptable users and programs are able to run on the
machine that Ceph will permit to access its object store.</p>
<p>The keys used to authenticate Ceph clients and servers are typically stored in
a plain text file with appropriate permissions in a trusted host.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Storing keys in plaintext files has security shortcomings, but
they are difficult to avoid, given the basic authentication methods Ceph
uses in the background. Those setting up Ceph systems should be aware of
these shortcomings.</p>
</div>
<p>In particular, arbitrary user machines, especially portable machines, should not
be configured to interact directly with Ceph, since that mode of use would
require the storage of a plaintext authentication key on an insecure machine.
Anyone  who stole that machine or obtained surreptitious access to it could
obtain the key that will allow them to authenticate their own machines to Ceph.</p>
<p>Rather than permitting potentially insecure machines to access a Ceph object
store directly,  users should be required to sign in to a trusted machine in
your environment using a method  that provides sufficient security for your
purposes.  That trusted machine will store the plaintext Ceph keys for the
human users.  A future version of Ceph may address these particular
authentication issues more fully.</p>
<p>At the moment, none of the Ceph authentication protocols provide secrecy for
messages in transit. Thus, an eavesdropper on the wire can hear and understand
all data sent between clients and servers in Ceph, even if it cannot create or
alter them. Further, Ceph does not include options to encrypt user data in the
object store. Users can hand-encrypt and store their own data in the Ceph
object store, of course, but Ceph provides no features to perform object
encryption itself. Those storing sensitive data in Ceph should consider
encrypting their data before providing it  to the Ceph system.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../">
              <img class="logo" src="../../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../../">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../start/">安装（快速）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">安装（手动）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rbd/rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/">开发文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases/">发布时间表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary/">Ceph 术语</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../">Ceph Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2014, Inktank Storage, Inc. and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring Ceph &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../../../" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../">Ceph Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuring-ceph">
<h1>Configuring Ceph<a class="headerlink" href="#configuring-ceph" title="Permalink to this headline">¶</a></h1>
<p>When you start the Ceph service, the initialization process activates a series
of daemons that run in the background. A <a class="reference internal" href="../../../../glossary/#term-ceph-storage-cluster"><em class="xref std std-term">Ceph Storage Cluster</em></a> runs
two types of daemons:</p>
<ul class="simple">
<li><a class="reference internal" href="../../../../glossary/#term-ceph-monitor"><em class="xref std std-term">Ceph Monitor</em></a> (<tt class="docutils literal"><span class="pre">ceph-mon</span></tt>)</li>
<li><a class="reference internal" href="../../../../glossary/#term-ceph-osd-daemon"><em class="xref std std-term">Ceph OSD Daemon</em></a> (<tt class="docutils literal"><span class="pre">ceph-osd</span></tt>)</li>
</ul>
<p>Ceph Storage Clusters that support the <a class="reference internal" href="../../../../glossary/#term-ceph-filesystem"><em class="xref std std-term">Ceph Filesystem</em></a> run at least one
<a class="reference internal" href="../../../../glossary/#term-ceph-metadata-server"><em class="xref std std-term">Ceph Metadata Server</em></a> (<tt class="docutils literal"><span class="pre">ceph-mds</span></tt>). Clusters that support <a class="reference internal" href="../../../../glossary/#term-ceph-object-storage"><em class="xref std std-term">Ceph
Object Storage</em></a> run Ceph Gateway daemons (<tt class="docutils literal"><span class="pre">radosgw</span></tt>). For your convenience,
each daemon has a series of default values (<em>i.e.</em>, many are set by
<tt class="docutils literal"><span class="pre">ceph/src/common/config_opts.h</span></tt>). You may override these settings with a Ceph
configuration file.</p>
<div class="section" id="the-configuration-file">
<span id="ceph-conf-file"></span><h2>The Configuration File<a class="headerlink" href="#the-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>When you start a Ceph Storage Cluster, each daemon looks for a Ceph
configuration file (i.e., <tt class="docutils literal"><span class="pre">ceph.conf</span></tt> by default) that provides the cluster&#8217;s
configuration settings. For manual deployments, you need to create a Ceph
configuration file. For tools that create configuration files for you (<em>e.g.</em>,
<tt class="docutils literal"><span class="pre">ceph-deploy</span></tt>, Chef, etc.), you may use the information contained herein as a
reference. The Ceph configuration file defines:</p>
<ul class="simple">
<li>Cluster Identity</li>
<li>Authentication settings</li>
<li>Cluster membership</li>
<li>Host names</li>
<li>Host addresses</li>
<li>Paths to keyrings</li>
<li>Paths to journals</li>
<li>Paths to data</li>
<li>Other runtime options</li>
</ul>
<p>The default Ceph configuration file locations in sequential order include:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">$CEPH_CONF</span></tt> (<em>i.e.,</em> the path following the <tt class="docutils literal"><span class="pre">$CEPH_CONF</span></tt>
environment variable)</li>
<li><tt class="docutils literal"><span class="pre">-c</span> <span class="pre">path/path</span></tt>  (<em>i.e.,</em> the <tt class="docutils literal"><span class="pre">-c</span></tt> command line argument)</li>
<li><tt class="docutils literal"><span class="pre">/etc/ceph/ceph.conf</span></tt></li>
<li><tt class="docutils literal"><span class="pre">~/.ceph/config</span></tt></li>
<li><tt class="docutils literal"><span class="pre">./ceph.conf</span></tt> (<em>i.e.,</em> in the current working directory)</li>
</ol>
<p>The Ceph configuration file uses an <em>ini</em> style syntax. You can add comments
by preceding comments with a pound sign (#) or a semi-colon (;).  For example:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="c1"># &lt;--A number (#) sign precedes a comment.</span>
<span class="c1">; A comment may be anything.</span>
<span class="c1"># Comments always follow a semi-colon (;) or a pound (#) on each line.</span>
<span class="c1"># The end of the line terminates a comment.</span>
<span class="c1"># We recommend that you provide comments in your configuration file(s).</span>
</pre></div>
</div>
</div>
<div class="section" id="config-sections">
<span id="ceph-conf-settings"></span><h2>Config Sections<a class="headerlink" href="#config-sections" title="Permalink to this headline">¶</a></h2>
<p>The configuration file can configure all Ceph daemons in a Ceph Storage Cluster,
or all Ceph daemons of a particular type. To configure a series of daemons, the
settings must be included under the processes that will receive the
configuration as follows:</p>
<p><tt class="docutils literal"><span class="pre">[global]</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Settings under <tt class="docutils literal"><span class="pre">[global]</span></tt> affect all daemons in a Ceph Storage
Cluster.</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">auth</span> <span class="pre">supported</span> <span class="pre">=</span> <span class="pre">cephx</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">[osd]</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Settings under <tt class="docutils literal"><span class="pre">[osd]</span></tt> affect all <tt class="docutils literal"><span class="pre">ceph-osd</span></tt> daemons in
the Ceph Storage Cluster, and override the same setting in
<tt class="docutils literal"><span class="pre">[global]</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">osd</span> <span class="pre">journal</span> <span class="pre">size</span> <span class="pre">=</span> <span class="pre">1000</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">[mon]</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Settings under <tt class="docutils literal"><span class="pre">[mon]</span></tt> affect all <tt class="docutils literal"><span class="pre">ceph-mon</span></tt> daemons in
the Ceph Storage Cluster, and override the same setting in
<tt class="docutils literal"><span class="pre">[global]</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">addr</span> <span class="pre">=</span> <span class="pre">10.0.0.101:6789</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">[mds]</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Settings under <tt class="docutils literal"><span class="pre">[mds]</span></tt> affect all <tt class="docutils literal"><span class="pre">ceph-mds</span></tt> daemons in
the Ceph Storage Cluster, and override the same setting in
<tt class="docutils literal"><span class="pre">[global]</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">host</span> <span class="pre">=</span> <span class="pre">myserver01</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">[client]</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Settings under <tt class="docutils literal"><span class="pre">[client]</span></tt> affect all Ceph Clients
(e.g., mounted Ceph Filesystems, mounted Ceph Block Devices,
etc.).</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">log</span> <span class="pre">file</span> <span class="pre">=</span> <span class="pre">/var/log/ceph/radosgw.log</span></tt></td>
</tr>
</tbody>
</table>
<p>Global settings affect all instances of all daemon in the Ceph Storage Cluster.
Use the <tt class="docutils literal"><span class="pre">[global]</span></tt> setting for values that are common for all daemons in the
Ceph Storage Cluster. You can override each <tt class="docutils literal"><span class="pre">[global]</span></tt> setting by:</p>
<ol class="arabic simple">
<li>Changing the setting in a particular process type
(<em>e.g.,</em> <tt class="docutils literal"><span class="pre">[osd]</span></tt>, <tt class="docutils literal"><span class="pre">[mon]</span></tt>, <tt class="docutils literal"><span class="pre">[mds]</span></tt> ).</li>
<li>Changing the setting in a particular process (<em>e.g.,</em> <tt class="docutils literal"><span class="pre">[osd.1]</span></tt> ).</li>
</ol>
<p>Overriding a global setting affects all child processes, except those that
you specifically override in a particular daemon.</p>
<p>A typical global setting involves activating authentication. For example:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[global]</span>
<span class="c1">#Enable authentication between hosts within the cluster.</span>
<span class="c1">#v 0.54 and earlier</span>
<span class="na">auth supported</span> <span class="o">=</span> <span class="s">cephx</span>

<span class="c1">#v 0.55 and after</span>
<span class="na">auth cluster required</span> <span class="o">=</span> <span class="s">cephx</span>
<span class="na">auth service required</span> <span class="o">=</span> <span class="s">cephx</span>
<span class="na">auth client required</span> <span class="o">=</span> <span class="s">cephx</span>
</pre></div>
</div>
<p>You can specify settings that apply to a particular type of daemon. When you
specify settings under <tt class="docutils literal"><span class="pre">[osd]</span></tt>, <tt class="docutils literal"><span class="pre">[mon]</span></tt> or <tt class="docutils literal"><span class="pre">[mds]</span></tt> without specifying a
particular instance, the setting will apply to all OSDs, monitors or metadata
daemons respectively.</p>
<p>A typical daemon-wide setting involves setting journal sizes, filestore
settings, etc. For example:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[osd]</span>
<span class="na">osd journal size</span> <span class="o">=</span> <span class="s">1000</span>
</pre></div>
</div>
<p>You may specify settings for particular instances of a daemon. You may specify
an instance by entering its type, delimited by a period (.) and by the instance
ID. The instance ID for a Ceph OSD Daemon is always numeric, but it may be
alphanumeric for Ceph Monitors and Ceph Metadata Servers.</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[osd.1]</span>
<span class="c1"># settings affect osd.1 only.</span>

<span class="k">[mon.a]</span>
<span class="c1"># settings affect mon.a only.</span>

<span class="k">[mds.b]</span>
<span class="c1"># settings affect mds.b only.</span>
</pre></div>
</div>
<p>If the daemon you specify is a Ceph Gateway client, specify the daemon and the
instance, delimited by a period (.). For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">client</span><span class="o">.</span><span class="n">radosgw</span><span class="o">.</span><span class="n">instance</span><span class="o">-</span><span class="n">name</span><span class="p">]</span>
<span class="c"># settings affect client.radosgw.instance-name only.</span>
</pre></div>
</div>
</div>
<div class="section" id="metavariables">
<span id="ceph-metavariables"></span><h2>Metavariables<a class="headerlink" href="#metavariables" title="Permalink to this headline">¶</a></h2>
<p>Metavariables simplify Ceph Storage Cluster configuration dramatically. When a
metavariable is set in a configuration value, Ceph expands the metavariable into
a concrete value. Metavariables are very powerful when used within the
<tt class="docutils literal"><span class="pre">[global]</span></tt>, <tt class="docutils literal"><span class="pre">[osd]</span></tt>, <tt class="docutils literal"><span class="pre">[mon]</span></tt>, <tt class="docutils literal"><span class="pre">[mds]</span></tt> or <tt class="docutils literal"><span class="pre">[client]</span></tt> sections of your
configuration file. Ceph metavariables are similar to Bash shell expansion.</p>
<p>Ceph supports the following metavariables:</p>
<p><tt class="docutils literal"><span class="pre">$cluster</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Expands to the Ceph Storage Cluster name. Useful when running
multiple Ceph Storage Clusters on the same hardware.</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">/etc/ceph/$cluster.keyring</span></tt></td>
</tr>
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body"><tt class="docutils literal"><span class="pre">ceph</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">$type</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Expands to one of <tt class="docutils literal"><span class="pre">mds</span></tt>, <tt class="docutils literal"><span class="pre">osd</span></tt>, or <tt class="docutils literal"><span class="pre">mon</span></tt>, depending on the
type of the instant daemon.</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">/var/lib/ceph/$type</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">$id</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Expands to the daemon identifier. For <tt class="docutils literal"><span class="pre">osd.0</span></tt>, this would be
<tt class="docutils literal"><span class="pre">0</span></tt>; for <tt class="docutils literal"><span class="pre">mds.a</span></tt>, it would be <tt class="docutils literal"><span class="pre">a</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">/var/lib/ceph/$type/$cluster-$id</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">$host</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Expands to the host name of the instant daemon.</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">$name</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Expands to <tt class="docutils literal"><span class="pre">$type.$id</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"><tt class="docutils literal"><span class="pre">/var/run/ceph/$cluster-$name.asok</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="common-settings">
<span id="ceph-conf-common-settings"></span><h2>Common Settings<a class="headerlink" href="#common-settings" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="../../../install/hardware-recommendations">Hardware Recommendations</a> section provides some hardware guidelines for
configuring a Ceph Storage Cluster. It is possible for a single <a class="reference internal" href="../../../../glossary/#term-ceph-node"><em class="xref std std-term">Ceph
Node</em></a> to run multiple daemons. For example, a single node with multiple drives
may run one <tt class="docutils literal"><span class="pre">ceph-osd</span></tt> for each drive. Ideally, you will  have a node for a
particular type of process. For example, some nodes may run <tt class="docutils literal"><span class="pre">ceph-osd</span></tt>
daemons, other nodes may run <tt class="docutils literal"><span class="pre">ceph-mds</span></tt> daemons, and still  other nodes may
run <tt class="docutils literal"><span class="pre">ceph-mon</span></tt> daemons.</p>
<p>Each node has a name identified by the <tt class="docutils literal"><span class="pre">host</span></tt> setting. Monitors also specify
a network address and port (i.e., domain name or IP address) identified by the
<tt class="docutils literal"><span class="pre">addr</span></tt> setting.  A basic configuration file will typically specify only
minimal settings for each instance of monitor daemons. For example:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[global]</span>
<span class="na">mon_initial_members</span> <span class="o">=</span> <span class="s">ceph1</span>
<span class="na">mon_host</span> <span class="o">=</span> <span class="s">10.0.0.1</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The <tt class="docutils literal"><span class="pre">host</span></tt> setting is the short name of the node (i.e., not
an fqdn). It is <strong>NOT</strong> an IP address either.  Enter <tt class="docutils literal"><span class="pre">hostname</span> <span class="pre">-s</span></tt> on
the command line to retrieve the name of the node. Do not use <tt class="docutils literal"><span class="pre">host</span></tt>
settings for anything other than initial monitors unless you are deploying
Ceph manually. You <strong>MUST NOT</strong> specify <tt class="docutils literal"><span class="pre">host</span></tt> under individual daemons
when using deployment tools like <tt class="docutils literal"><span class="pre">chef</span></tt> or <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt>, as those tools
will enter the appropriate values for you in the cluster map.</p>
</div>
</div>
<div class="section" id="networks">
<span id="ceph-network-config"></span><h2>Networks<a class="headerlink" href="#networks" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference external" href="../network-config-ref">Network Configuration Reference</a> for a detailed discussion about
configuring a network for use with Ceph.</p>
</div>
<div class="section" id="monitors">
<h2>Monitors<a class="headerlink" href="#monitors" title="Permalink to this headline">¶</a></h2>
<p>Ceph production clusters typically deploy with a minimum 3 <a class="reference internal" href="../../../../glossary/#term-ceph-monitor"><em class="xref std std-term">Ceph Monitor</em></a>
daemons to ensure high availability should a monitor instance crash. At least
three (3) monitors ensures that the Paxos algorithm can determine which version
of the <a class="reference internal" href="../../../../glossary/#term-ceph-cluster-map"><em class="xref std std-term">Ceph Cluster Map</em></a> is the most recent from a majority of Ceph
Monitors in the quorum.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may deploy Ceph with a single monitor, but if the instance fails,
the lack of other monitors may interrupt data service availability.</p>
</div>
<p>Ceph Monitors typically listen on port <tt class="docutils literal"><span class="pre">6789</span></tt>. For example:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[mon.a]</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">hostName</span>
<span class="na">mon addr</span> <span class="o">=</span> <span class="s">150.140.130.120:6789</span>
</pre></div>
</div>
<p>By default, Ceph expects that you will store a monitor&#8217;s data under the
following path:</p>
<div class="highlight-python"><pre>/var/lib/ceph/mon/$cluster-$id</pre>
</div>
<p>You or a deployment tool (e.g., <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt>) must create the corresponding
directory. With metavariables fully  expressed and a cluster named &#8220;ceph&#8221;, the
foregoing directory would evaluate to:</p>
<div class="highlight-python"><pre>/var/lib/ceph/mon/ceph-a</pre>
</div>
<p>For additional details, see the <a class="reference external" href="../mon-config-ref">Monitor Config Reference</a>.</p>
</div>
<div class="section" id="authentication">
<span id="ceph-osd-config"></span><h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p class="versionadded">
<span class="versionmodified">New in version Bobtail: </span>0.56</p>
<p>For Bobtail (v 0.56) and beyond, you should expressly enable or disable
authentication in the <tt class="docutils literal"><span class="pre">[global]</span></tt> section of your Ceph configuration file.</p>
<div class="highlight-python"><pre>auth cluster required = cephx
auth service required = cephx
auth client required = cephx</pre>
</div>
<p>Additionally, you should enable message signing. See <a class="reference external" href="../auth-config-ref">Cephx Config Reference</a>
and  <a class="reference external" href="../../operations/authentication">Cephx Authentication</a> for details.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">When upgrading, we recommend expressly disabling authentication
first, then perform the upgrade. Once the upgrade is complete, re-enable
authentication.</p>
</div>
</div>
<div class="section" id="osds">
<span id="ceph-monitor-config"></span><h2>OSDs<a class="headerlink" href="#osds" title="Permalink to this headline">¶</a></h2>
<p>Ceph production clusters typically deploy <em class="xref std std-term">Ceph OSD Daemons</em> where one node
has one OSD daemon running a filestore on one storage drive. A typical
deployment specifies a journal size. For example:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[osd]</span>
<span class="na">osd journal size</span> <span class="o">=</span> <span class="s">10000</span>

<span class="k">[osd.0]</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">{hostname} #manual deployments only.</span>
</pre></div>
</div>
<p>By default, Ceph expects that you will store a Ceph OSD Daemon&#8217;s data with the
following path:</p>
<div class="highlight-python"><pre>/var/lib/ceph/osd/$cluster-$id</pre>
</div>
<p>You or a deployment tool (e.g., <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt>) must create the corresponding
directory. With metavariables fully  expressed and a cluster named &#8220;ceph&#8221;, the
foregoing directory would evaluate to:</p>
<div class="highlight-python"><pre>/var/lib/ceph/osd/ceph-0</pre>
</div>
<p>You may override this path using the <tt class="docutils literal"><span class="pre">osd</span> <span class="pre">data</span></tt> setting. We don&#8217;t recommend
changing the default location. Create the default directory on your OSD host.</p>
<div class="highlight-python"><pre>ssh {osd-host}
sudo mkdir /var/lib/ceph/osd/ceph-{osd-number}</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">osd</span> <span class="pre">data</span></tt> path ideally leads to a mount point with a hard disk that is
separate from the hard disk storing and running the operating system and
daemons. If the OSD is for a disk other than the OS disk, prepare it for
use with Ceph, and mount it to the directory you just created:</p>
<div class="highlight-python"><pre>ssh {new-osd-host}
sudo mkfs -t {fstype} /dev/{disk}
sudo mount -o user_xattr /dev/{hdd} /var/lib/ceph/osd/ceph-{osd-number}</pre>
</div>
<p>We recommend using the <tt class="docutils literal"><span class="pre">xfs</span></tt> file system or the <tt class="docutils literal"><span class="pre">btrfs</span></tt> file system when
running <strong class="command">mkfs</strong>.</p>
<p>See the <a class="reference external" href="../osd-config-ref">OSD Config Reference</a> for additional configuration details.</p>
</div>
<div class="section" id="heartbeats">
<h2>Heartbeats<a class="headerlink" href="#heartbeats" title="Permalink to this headline">¶</a></h2>
<p>During runtime operations, Ceph OSD Daemons check up on other Ceph OSD Daemons
and report their  findings to the Ceph Monitor. You do not have to provide any
settings. However, if you have network latency issues, you may wish to modify
the settings.</p>
<p>See <a class="reference external" href="../mon-osd-interaction">Configuring Monitor/OSD Interaction</a> for additional details.</p>
</div>
<div class="section" id="logs-debugging">
<span id="ceph-logging-and-debugging"></span><h2>Logs / Debugging<a class="headerlink" href="#logs-debugging" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you may encounter issues with Ceph that require
modifying logging output and using Ceph&#8217;s debugging. See <a class="reference external" href="../../troubleshooting/log-and-debug">Debugging and
Logging</a> for details on log rotation.</p>
</div>
<div class="section" id="example-ceph-conf">
<h2>Example ceph.conf<a class="headerlink" href="#example-ceph-conf" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[global]</span>
<span class="na">fsid</span> <span class="o">=</span> <span class="s">{cluster-id}</span>
<span class="na">mon initial members</span> <span class="o">=</span> <span class="s">{hostname}[, {hostname}]</span>
<span class="na">mon host</span> <span class="o">=</span> <span class="s">{ip-address}[, {ip-address}]</span>

<span class="c1">#All clusters have a front-side public network.</span>
<span class="c1">#If you have two NICs, you can configure a back side cluster </span>
<span class="c1">#network for OSD object replication, heart beats, backfilling,</span>
<span class="c1">#recovery, etc.</span>
<span class="na">public network</span> <span class="o">=</span> <span class="s">{network}[, {network}]</span>
<span class="c1">#cluster network = {network}[, {network}] </span>

<span class="c1">#Clusters require authentication by default.</span>
<span class="na">auth cluster required</span> <span class="o">=</span> <span class="s">cephx</span>
<span class="na">auth service required</span> <span class="o">=</span> <span class="s">cephx</span>
<span class="na">auth client required</span> <span class="o">=</span> <span class="s">cephx</span>

<span class="c1">#Choose reasonable numbers for your journals, number of replicas</span>
<span class="c1">#and placement groups.</span>
<span class="na">osd journal size</span> <span class="o">=</span> <span class="s">{n}</span>
<span class="na">osd pool default size</span> <span class="o">=</span> <span class="s">{n}  # Write an object n times.</span>
<span class="na">osd pool default min size</span> <span class="o">=</span> <span class="s">{n} # Allow writing n copy in a degraded state.</span>
<span class="na">osd pool default pg num</span> <span class="o">=</span> <span class="s">{n}</span>
<span class="na">osd pool default pgp num</span> <span class="o">=</span> <span class="s">{n}</span>

<span class="c1">#Choose a reasonable crush leaf type.</span>
<span class="c1">#0 for a 1-node cluster.</span>
<span class="c1">#1 for a multi node cluster in a single rack</span>
<span class="c1">#2 for a multi node, multi chassis cluster with multiple hosts in a chassis</span>
<span class="c1">#3 for a multi node cluster with hosts across racks, etc.</span>
<span class="na">osd crush chooseleaf type</span> <span class="o">=</span> <span class="s">{n}</span>
</pre></div>
</div>
</div>
<div class="section" id="runtime-changes">
<span id="ceph-runtime-config"></span><h2>Runtime Changes<a class="headerlink" href="#runtime-changes" title="Permalink to this headline">¶</a></h2>
<p>Ceph allows you to make changes to the configuration of a <tt class="docutils literal"><span class="pre">ceph-osd</span></tt>,
<tt class="docutils literal"><span class="pre">ceph-mon</span></tt>, or <tt class="docutils literal"><span class="pre">ceph-mds</span></tt> daemon at runtime. This capability is quite
useful for increasing/decreasing logging output, enabling/disabling debug
settings, and even for runtime optimization. The following reflects runtime
configuration usage:</p>
<div class="highlight-python"><pre>ceph tell {daemon-type}.{id or *} injectargs --{name} {value} [--{name} {value}]</pre>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">{daemon-type}</span></tt> with one of <tt class="docutils literal"><span class="pre">osd</span></tt>, <tt class="docutils literal"><span class="pre">mon</span></tt> or <tt class="docutils literal"><span class="pre">mds</span></tt>. You may apply
the  runtime setting to all daemons of a particular type with <tt class="docutils literal"><span class="pre">*</span></tt>, or specify
a specific  daemon&#8217;s ID (i.e., its number or letter). For example, to increase
debug logging for a <tt class="docutils literal"><span class="pre">ceph-osd</span></tt> daemon named <tt class="docutils literal"><span class="pre">osd.0</span></tt>, execute the following:</p>
<div class="highlight-python"><pre>ceph tell osd.0 injectargs --debug-osd 20 --debug-ms 1</pre>
</div>
<p>In your <tt class="docutils literal"><span class="pre">ceph.conf</span></tt> file, you may use spaces when specifying a
setting name.  When specifying a setting name on the command line,
ensure that you use an underscore or hyphen (<tt class="docutils literal"><span class="pre">_</span></tt> or <tt class="docutils literal"><span class="pre">-</span></tt>) between
terms (e.g., <tt class="docutils literal"><span class="pre">debug</span> <span class="pre">osd</span></tt> becomes <tt class="docutils literal"><span class="pre">--debug-osd</span></tt>).</p>
</div>
<div class="section" id="viewing-a-configuration-at-runtime">
<h2>Viewing a Configuration at Runtime<a class="headerlink" href="#viewing-a-configuration-at-runtime" title="Permalink to this headline">¶</a></h2>
<p>If your Ceph Storage Cluster is running, and you would like to see the
configuration settings from a running daemon, execute the following:</p>
<div class="highlight-python"><pre>ceph daemon {daemon-type}.{id} config show | less</pre>
</div>
<p>If you are on a machine where osd.0 is running, the command would be:</p>
<div class="highlight-python"><pre>ceph daemon osd.0 config show | less</pre>
</div>
</div>
<div class="section" id="running-multiple-clusters">
<h2>Running Multiple Clusters<a class="headerlink" href="#running-multiple-clusters" title="Permalink to this headline">¶</a></h2>
<p>With Ceph, you can run multiple Ceph Storage Clusters on the same hardware.
Running multiple clusters provides a higher level of isolation compared to
using different pools on the same cluster with different CRUSH rulesets. A
separate cluster will have separate monitor, OSD and metadata server processes.
When running Ceph with  default settings, the default cluster name is <tt class="docutils literal"><span class="pre">ceph</span></tt>,
which means you would  save your Ceph configuration file with the file name
<tt class="docutils literal"><span class="pre">ceph.conf</span></tt> in the  <tt class="docutils literal"><span class="pre">/etc/ceph</span></tt> default directory.</p>
<p>See <a class="reference external" href="../../deployment/ceph-deploy-new#naming-a-cluster">ceph-deploy new</a> for details.
.. _ceph-deploy new:../ceph-deploy-new</p>
<p>When you run multiple clusters, you must name your cluster and save the Ceph
configuration file with the name of the cluster. For example, a cluster named
<tt class="docutils literal"><span class="pre">openstack</span></tt> will have a Ceph configuration file with the file name
<tt class="docutils literal"><span class="pre">openstack.conf</span></tt> in the  <tt class="docutils literal"><span class="pre">/etc/ceph</span></tt> default directory.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Cluster names must consist of letters a-z and digits 0-9 only.</p>
</div>
<p>Separate clusters imply separate data disks and journals, which are not shared
between clusters. Referring to <a class="reference internal" href="#metavariables">Metavariables</a>, the <tt class="docutils literal"><span class="pre">$cluster</span></tt>  metavariable
evaluates to the cluster name (i.e., <tt class="docutils literal"><span class="pre">openstack</span></tt> in the  foregoing example).
Various settings use the <tt class="docutils literal"><span class="pre">$cluster</span></tt> metavariable, including:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">keyring</span></tt></li>
<li><tt class="docutils literal"><span class="pre">admin</span> <span class="pre">socket</span></tt></li>
<li><tt class="docutils literal"><span class="pre">log</span> <span class="pre">file</span></tt></li>
<li><tt class="docutils literal"><span class="pre">pid</span> <span class="pre">file</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">data</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">cluster</span> <span class="pre">log</span> <span class="pre">file</span></tt></li>
<li><tt class="docutils literal"><span class="pre">osd</span> <span class="pre">data</span></tt></li>
<li><tt class="docutils literal"><span class="pre">osd</span> <span class="pre">journal</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mds</span> <span class="pre">data</span></tt></li>
<li><tt class="docutils literal"><span class="pre">rgw</span> <span class="pre">data</span></tt></li>
</ul>
<p>See <a class="reference external" href="../general-config-ref">General Settings</a>, <a class="reference external" href="../osd-config-ref">OSD Settings</a>, <a class="reference external" href="../mon-config-ref">Monitor Settings</a>, <a class="reference external" href="../../../cephfs/mds-config-ref">MDS Settings</a>,
<a class="reference external" href="../../../radosgw/config-ref/">RGW Settings</a> and <a class="reference external" href="../../troubleshooting/log-and-debug">Log Settings</a> for relevant path defaults that use the
<tt class="docutils literal"><span class="pre">$cluster</span></tt> metavariable.</p>
<p>When creating default directories or files, you should use the cluster
name at the appropriate places in the path. For example:</p>
<div class="highlight-python"><pre>sudo mkdir /var/lib/ceph/osd/openstack-0
sudo mkdir /var/lib/ceph/mon/openstack-a</pre>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">When running monitors on the same host, you should use
different ports. By default, monitors use port 6789. If you already
have monitors using port 6789, use a different port for your other cluster(s).</p>
</div>
<p>To invoke a cluster other than the default <tt class="docutils literal"><span class="pre">ceph</span></tt> cluster, use the
<tt class="docutils literal"><span class="pre">-c</span> <span class="pre">{filename}.conf</span></tt> option with the <tt class="docutils literal"><span class="pre">ceph</span></tt> command. For example:</p>
<div class="highlight-python"><pre>ceph -c {cluster-name}.conf health
ceph -c openstack.conf health</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../">
              <img class="logo" src="../../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../../">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../start/">安装（快速）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">安装（手动）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rbd/rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/">开发文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases/">发布时间表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary/">Ceph 术语</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../">Ceph Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2014, Inktank Storage, Inc. and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>
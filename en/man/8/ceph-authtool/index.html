
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ceph-authtool – ceph keyring manipulation tool &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../../../" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../">Ceph Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ceph-authtool-ceph-keyring-manipulation-tool">
<h1>ceph-authtool &#8211; ceph keyring manipulation tool<a class="headerlink" href="#ceph-authtool-ceph-keyring-manipulation-tool" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>ceph-authtool</strong> <em>keyringfile</em> [ -l | &#8211;list ] [ -C | &#8211;create-keyring
] [ -p | &#8211;print ] [ -n | &#8211;name <em>entityname</em> ] [ &#8211;gen-key ] [ -a |
&#8211;add-key <em>base64_key</em> ] [ &#8211;caps <em>capfile</em> ]</div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><strong>ceph-authtool</strong> is a utility to create, view, and modify a Ceph keyring
file. A keyring file stores one or more Ceph authentication keys and
possibly an associated capability specification. Each key is
associated with an entity name, of the form
<tt class="docutils literal"><span class="pre">{client,mon,mds,osd}.name</span></tt>.</p>
<p><strong>WARNING</strong> Ceph provides authentication and protection against
man-in-the-middle attacks once secret keys are in place.  However,
data over the wire is not encrypted, which may include the messages
used to configure said keys.  The system is primarily intended to be
used in trusted environments.</p>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-ceph-authtool-l">
<tt class="descname">-l</tt><tt class="descclassname"></tt><tt class="descclassname">, </tt><tt class="descname">--list</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-ceph-authtool-l" title="Permalink to this definition">¶</a></dt>
<dd><p>will list all keys and capabilities present in the keyring</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-authtool-p">
<tt class="descname">-p</tt><tt class="descclassname"></tt><tt class="descclassname">, </tt><tt class="descname">--print</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-ceph-authtool-p" title="Permalink to this definition">¶</a></dt>
<dd><p>will print an encoded key for the specified entityname. This is
suitable for the <tt class="docutils literal"><span class="pre">mount</span> <span class="pre">-o</span> <span class="pre">secret=</span></tt> argument</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-authtool-C">
<tt class="descname">-C</tt><tt class="descclassname"></tt><tt class="descclassname">, </tt><tt class="descname">--create-keyring</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-ceph-authtool-C" title="Permalink to this definition">¶</a></dt>
<dd><p>will create a new keyring, overwriting any existing keyringfile</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-authtool--gen-key">
<tt class="descname">--gen-key</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-ceph-authtool--gen-key" title="Permalink to this definition">¶</a></dt>
<dd><p>will generate a new secret key for the specified entityname</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-authtool--add-key">
<tt class="descname">--add-key</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-ceph-authtool--add-key" title="Permalink to this definition">¶</a></dt>
<dd><p>will add an encoded key to the keyring</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-authtool--cap">
<tt class="descname">--cap</tt><tt class="descclassname"> subsystem capability</tt><a class="headerlink" href="#cmdoption-ceph-authtool--cap" title="Permalink to this definition">¶</a></dt>
<dd><p>will set the capability for given subsystem</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-ceph-authtool--caps">
<tt class="descname">--caps</tt><tt class="descclassname"> capsfile</tt><a class="headerlink" href="#cmdoption-ceph-authtool--caps" title="Permalink to this definition">¶</a></dt>
<dd><p>will set all of capabilities associated with a given key, for all subsystems</p>
</dd></dl>

</div>
<div class="section" id="capabilities">
<h2>Capabilities<a class="headerlink" href="#capabilities" title="Permalink to this headline">¶</a></h2>
<p>The subsystem is the name of a Ceph subsystem: <tt class="docutils literal"><span class="pre">mon</span></tt>, <tt class="docutils literal"><span class="pre">mds</span></tt>, or
<tt class="docutils literal"><span class="pre">osd</span></tt>.</p>
<p>The capability is a string describing what the given user is allowed
to do. This takes the form of a comma separated list of allow
clauses with a permission specifier containing one or more of rwx for
read, write, and execute permission. The <tt class="docutils literal"><span class="pre">allow</span> <span class="pre">*</span></tt> grants full
superuser permissions for the given subsystem.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># can read, write, and execute objects</span>
<span class="n">osd</span> <span class="o">=</span> <span class="s">&quot;allow rwx&quot;</span>

<span class="c"># can access mds server</span>
<span class="n">mds</span> <span class="o">=</span> <span class="s">&quot;allow&quot;</span>

<span class="c"># can modify cluster state (i.e., is a server daemon)</span>
<span class="n">mon</span> <span class="o">=</span> <span class="s">&quot;allow rwx&quot;</span>
</pre></div>
</div>
<p>A librados user restricted to a single pool might look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mon</span> <span class="o">=</span> <span class="s">&quot;allow r&quot;</span>

<span class="n">osd</span> <span class="o">=</span> <span class="s">&quot;allow rw pool foo&quot;</span>
</pre></div>
</div>
<p>A client using rbd with read access to one pool and read/write access to another:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mon</span> <span class="o">=</span> <span class="s">&quot;allow r&quot;</span>

<span class="n">osd</span> <span class="o">=</span> <span class="s">&quot;allow class-read object_prefix rbd_children, allow pool templates r class-read, allow pool vms rwx&quot;</span>
</pre></div>
</div>
<p>A client mounting the file system with minimal permissions would need caps like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mds</span> <span class="o">=</span> <span class="s">&quot;allow&quot;</span>

<span class="n">osd</span> <span class="o">=</span> <span class="s">&quot;allow rw pool data&quot;</span>

<span class="n">mon</span> <span class="o">=</span> <span class="s">&quot;allow r&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="osd-capabilities">
<h2>OSD Capabilities<a class="headerlink" href="#osd-capabilities" title="Permalink to this headline">¶</a></h2>
<p>In general, an osd capability follows the grammar:</p>
<div class="highlight-python"><pre>osdcap  := grant[,grant...]
grant   := allow (match capspec | capspec match)
match   := [pool[=]&lt;poolname&gt; | object_prefix &lt;prefix&gt;]
capspec := * | [r][w][x] [class-read] [class-write]</pre>
</div>
<p>The capspec determines what kind of operations the entity can perform:</p>
<div class="highlight-python"><pre>r           = read access to objects
w           = write access to objects
x           = can call any class method (same as class-read class-write)
class-read  = can call class methods that are reads
class-write = can call class methods that are writes
*           = equivalent to rwx, plus the ability to run osd admin commands,
              i.e. ceph osd tell ...</pre>
</div>
<p>The match criteria restrict a grant based on the pool being accessed.
Grants are additive if the client fulfills the match condition. For
example, if a client has the osd capabilities: &#8220;allow r object_prefix
prefix, allow w pool foo, allow x pool bar&#8221;, then it has rw access to
pool foo, rx access to pool bar, and r access to objects whose
names begin with &#8216;prefix&#8217; in any pool.</p>
</div>
<div class="section" id="caps-file-format">
<h2>Caps file format<a class="headerlink" href="#caps-file-format" title="Permalink to this headline">¶</a></h2>
<p>The caps file format consists of zero or more key/value pairs, one per
line. The key and value are separated by an <tt class="docutils literal"><span class="pre">=</span></tt>, and the value must
be quoted (with <tt class="docutils literal"><span class="pre">'</span></tt> or <tt class="docutils literal"><span class="pre">&quot;</span></tt>) if it contains any whitespace. The key
is the name of the Ceph subsystem (<tt class="docutils literal"><span class="pre">osd</span></tt>, <tt class="docutils literal"><span class="pre">mds</span></tt>, <tt class="docutils literal"><span class="pre">mon</span></tt>), and the
value is the capability string (see above).</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>To create a new keyring containing a key for client.foo:</p>
<div class="highlight-python"><pre>ceph-authtool -C -n client.foo --gen-key keyring</pre>
</div>
<p>To associate some capabilities with the key (namely, the ability to
mount a Ceph filesystem):</p>
<div class="highlight-python"><pre>ceph-authtool -n client.foo --cap mds 'allow' --cap osd 'allow rw pool=data' --cap mon 'allow r' keyring</pre>
</div>
<p>To display the contents of the keyring:</p>
<div class="highlight-python"><pre>ceph-authtool -l keyring</pre>
</div>
<p>When mounting a Ceph file system, you can grab the appropriately encoded secret key with:</p>
<div class="highlight-python"><pre>mount -t ceph serverhost:/ mountpoint -o name=foo,secret=`ceph-authtool -p -n client.foo keyring`</pre>
</div>
</div>
<div class="section" id="availability">
<h2>Availability<a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h2>
<p><strong>ceph-authtool</strong> is part of Ceph, a massively scalable, open-source, distributed storage system. Please
refer to the Ceph documentation at <a class="reference external" href="http://ceph.com/docs">http://ceph.com/docs</a> for more
information.</p>
</div>
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../ceph/"><em>ceph</em></a>(8)</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../">
              <img class="logo" src="../../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../../">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../start/">安装（快速）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/">安装（手动）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rbd/rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/">开发文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases/">发布时间表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary/">Ceph 术语</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../">Ceph Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2014, Inktank Storage, Inc. and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>
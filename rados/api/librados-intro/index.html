
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>librados 简介 &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../../" />
    <link rel="up" title="Ceph 存储集群 API" href="../" />
    <link rel="next" title="Librados (C)" href="../librados/" />
    <link rel="prev" title="Ceph 存储集群 API" href="../" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../librados/" title="Librados (C)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../" title="Ceph 存储集群 API"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../../" >Ceph 存储集群</a> &raquo;</li>
          <li><a href="../" accesskey="U">Ceph 存储集群 API</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="librados">
<h1>librados 简介<a class="headerlink" href="#librados" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="../../../glossary/#term-ceph-storage-cluster"><em class="xref std std-term">Ceph Storage Cluster</em></a> provides the basic storage service that allows
<a class="reference internal" href="../../../glossary/#term-3"><em class="xref std std-term">Ceph</em></a> to uniquely deliver <strong>object, block, and file storage</strong> in one
unified system. However, you are not limited to using the RESTful, block, or
POSIX interfaces. Based upon <abbr title="Reliable Autonomic Distributed Object Store">RADOS</abbr>, the <tt class="docutils literal"><span class="pre">librados</span></tt> API enables you to create your own interface to the
Ceph Storage Cluster.</p>
<p>The <tt class="docutils literal"><span class="pre">librados</span></tt> API enables you to interact with the two types of daemons in
the Ceph Storage Cluster:</p>
<ul class="simple">
<li>The <a class="reference internal" href="../../../glossary/#term-ceph-monitor"><em class="xref std std-term">Ceph Monitor</em></a>, which maintains a master copy of the cluster map.</li>
<li>The <a class="reference internal" href="../../../glossary/#term-ceph-osd-daemon"><em class="xref std std-term">Ceph OSD Daemon</em></a> (OSD), which stores data as objects on a storage node.</li>
</ul>
<p class="ditaa">
<img src="../../../_images/ditaa-1a91351293f441ce0238c21f2c432331a0f5a9d3.png"/>
</p>
<p>This guide provides a high-level introduction to using <tt class="docutils literal"><span class="pre">librados</span></tt>.
Refer to <a class="reference internal" href="../../../architecture/"><em>体系结构</em></a> for additional details of the Ceph
Storage Cluster. To use the API, you need a running Ceph Storage Cluster.
See <a class="reference external" href="../../../start">Installation (Quick)</a> for details.</p>
<div class="section" id="id1">
<h2>第一步：获取 librados<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>你的客户端应用必须绑定 <tt class="docutils literal"><span class="pre">librados</span></tt> 才能连接 Ceph 存储集群。在写使用 <tt class="docutils literal"><span class="pre">librados</span></tt> 的应用程序前，要安装 <tt class="docutils literal"><span class="pre">librados</span></tt> 及其他依赖包。 <tt class="docutils literal"><span class="pre">librados</span></tt> API 本身是用 C++ 实现的，另外有 C 、 Python 、 Java 和 PHP 绑定。</p>
<div class="section" id="getting-librados-for-c-c">
<h3>Getting librados for C/C++<a class="headerlink" href="#getting-librados-for-c-c" title="Permalink to this headline">¶</a></h3>
<p>To install <tt class="docutils literal"><span class="pre">librados</span></tt> development support files for C/C++ on Debian/Ubuntu
distributions, execute the following:</p>
<div class="highlight-python"><pre>sudo apt-get install librados-dev</pre>
</div>
<p>To install <tt class="docutils literal"><span class="pre">librados</span></tt> development support files for C/C++ on RHEL/CentOS
distributions, execute the following:</p>
<div class="highlight-python"><pre>sudo yum install librados2-devel</pre>
</div>
<p>Once you install <tt class="docutils literal"><span class="pre">librados</span></tt> for developers, you can find the required
headers for C/C++ under <tt class="docutils literal"><span class="pre">/usr/include/rados</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ls</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">rados</span>
</pre></div>
</div>
</div>
<div class="section" id="librados-python">
<h3>获取 librados 的 Python 支持<a class="headerlink" href="#librados-python" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">rados.py</span></tt> 模块为 Python 应用提供了 <tt class="docutils literal"><span class="pre">librados</span></tt> 支持。在 Debian/Ubuntu 下软件包名为 <tt class="docutils literal"><span class="pre">librados-dev</span></tt> ，在 RHEL/CentOS 下是 <tt class="docutils literal"><span class="pre">librados2-devel</span></tt> ，它们包含了 <tt class="docutils literal"><span class="pre">python-rados</span></tt> 包。你也可以直接安装 <tt class="docutils literal"><span class="pre">python-rados</span></tt> 。</p>
<p>要在 Debian/Ubuntu 发行版上安装 <tt class="docutils literal"><span class="pre">librados</span></tt> 的 Python 开发支持文件，用此命令：</p>
<div class="highlight-python"><pre>sudo apt-get install python-rados</pre>
</div>
<p>要在 RHEL/CentOS 发行版上安装 <tt class="docutils literal"><span class="pre">librados</span></tt> 的 Python 开发支持文件，用此命令：</p>
<div class="highlight-python"><pre>sudo yum install python-rados</pre>
</div>
<p>此模块在 Debian 风格的系统上安装到了 <tt class="docutils literal"><span class="pre">/usr/share/pyshared</span></tt> ，在 CentOS/RHEL 系统上安装到了 <tt class="docutils literal"><span class="pre">/usr/lib/python*/site-packages</span></tt> 。</p>
</div>
<div class="section" id="librados-java">
<h3>获取 librados 的 Java 支持<a class="headerlink" href="#librados-java" title="Permalink to this headline">¶</a></h3>
<p>要安装 <tt class="docutils literal"><span class="pre">librados</span></tt> 的 Java 支持，你需要执行下列步骤：</p>
<ol class="arabic">
<li><p class="first">安装 <tt class="docutils literal"><span class="pre">jna.jar</span></tt> 。在 Debian/Ubuntu 系统下应执行：</p>
<div class="highlight-python"><pre>sudo apt-get install libjna-java</pre>
</div>
<p>在 CentOS/RHEL 下应执行：</p>
<div class="highlight-python"><pre>sudo yum install jna</pre>
</div>
<p>JAR 文件位于 <tt class="docutils literal"><span class="pre">/usr/share/java</span></tt> 。</p>
</li>
<li><p class="first">克隆 <tt class="docutils literal"><span class="pre">rados-java</span></tt> 软件库：</p>
<div class="highlight-python"><pre>git clone --recursive https://github.com/ceph/rados-java.git</pre>
</div>
</li>
<li><p class="first">构建 <tt class="docutils literal"><span class="pre">rados-java</span></tt> 软件库：</p>
<div class="highlight-python"><pre>cd rados-java
ant</pre>
</div>
<p>JAR 文件位于 <tt class="docutils literal"><span class="pre">rados-java/target</span></tt> 。</p>
</li>
<li><p class="first">把 RADOS 的 JAR 文件复制到统一位置（如 <tt class="docutils literal"><span class="pre">/usr/share/java</span></tt> ），并确保它和 JNA JAR 都位于 JVM 的类路径里。例如：</p>
<div class="highlight-python"><pre>sudo cp target/rados-0.1.3.jar /usr/share/java/rados-0.1.3.jar
sudo ln -s /usr/share/java/jna-3.2.7.jar /usr/lib/jvm/default-java/jre/lib/ext/jna-3.2.7.jar
sudo ln -s /usr/share/java/rados-0.1.3.jar  /usr/lib/jvm/default-java/jre/lib/ext/rados-0.1.3.jar</pre>
</div>
</li>
</ol>
<p>要编译文档，用下列命令：</p>
<div class="highlight-python"><pre>ant docs</pre>
</div>
</div>
<div class="section" id="librados-php">
<h3>获取 librados 的 PHP 绑定<a class="headerlink" href="#librados-php" title="Permalink to this headline">¶</a></h3>
<p>要安装 <tt class="docutils literal"><span class="pre">librados</span></tt> 的 PHP 扩展，可按如下步骤：</p>
<ol class="arabic">
<li><p class="first">安装 php-dev ，在 Debian/Ubuntu 下应该执行：</p>
<div class="highlight-python"><pre>sudo apt-get install php5-dev build-essential</pre>
</div>
<p>在 CentOS/RHEL 下应该执行：</p>
<div class="highlight-python"><pre>sudo yum install php-devel</pre>
</div>
</li>
<li><p class="first">克隆 <tt class="docutils literal"><span class="pre">phprados</span></tt> 源码库：</p>
<div class="highlight-python"><pre>git clone https://github.com/ceph/phprados.git</pre>
</div>
</li>
<li><p class="first">构建 <tt class="docutils literal"><span class="pre">phprados</span></tt>:</p>
<div class="highlight-python"><pre>cd phprados
phpize
./configure
make
sudo make install</pre>
</div>
</li>
<li><p class="first">把下列配置加入 php.ini 以启用 <tt class="docutils literal"><span class="pre">phprados</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">extension</span><span class="o">=</span><span class="n">rados</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="id2">
<h2>第二步：配置集群句柄<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="../../../glossary/#term-ceph-client"><em class="xref std std-term">Ceph Client</em></a>, via <tt class="docutils literal"><span class="pre">librados</span></tt>, interacts directly with OSDs to store
and retrieve data. To interact with OSDs, the client app must invoke
<tt class="docutils literal"><span class="pre">librados</span></tt>  and connect to a Ceph Monitor. Once connected, <tt class="docutils literal"><span class="pre">librados</span></tt>
retrieves the  <a class="reference internal" href="../../../glossary/#term-cluster-map"><em class="xref std std-term">Cluster Map</em></a> from the Ceph Monitor. When the client app
wants to read or write data, it creates an I/O context and binds to a
<a class="reference internal" href="../../../glossary/#term-pool"><em class="xref std std-term">pool</em></a>. The pool has an associated <a class="reference internal" href="../../../glossary/#term-ruleset"><em class="xref std std-term">ruleset</em></a> that defines how it
will place data in the storage cluster. Via the I/O context, the client
provides the object name to <tt class="docutils literal"><span class="pre">librados</span></tt>, which takes the object name
and the cluster map (i.e., the topology of the cluster) and <a class="reference external" href="../../../architecture#calculating-pg-ids">computes</a> the
placement group and <a class="reference external" href="../../../architecture#mapping-pgs-to-osds">OSD</a>  for locating the data. Then the client application
can read or write data. The client app doesn&#8217;t need to learn about the topology
of the cluster directly.</p>
<p class="ditaa">
<img src="../../../_images/ditaa-65961c2ab9771b66c8c73e6d5fd648b0ea83c2da.png"/>
</p>
<p>The Ceph Storage Cluster handle encapsulates the client configuration, including:</p>
<ul class="simple">
<li>The <a class="reference external" href="../../operations/authentication#cephx-commandline-options">user ID</a> for <tt class="docutils literal"><span class="pre">rados_create()</span></tt> or user name for <tt class="docutils literal"><span class="pre">rados_create2()</span></tt>
(preferred).</li>
<li>The <a class="reference internal" href="../../../glossary/#term-cephx"><em class="xref std std-term">cephx</em></a> authentication key</li>
<li>The monitor ID and IP address</li>
<li>Logging levels</li>
<li>Debugging levels</li>
</ul>
<p>Thus, the first steps in using the cluster from your app are to 1) create
a cluster handle that your app will use to connect to the storage cluster,
and then 2) use that handle to connect. To connect to the cluster, the
app must supply a monitor address, a username and an authentication key
(cephx is enabled by default).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Talking to different Ceph Storage Clusters – or to the same cluster
with different users – requires different cluster handles.</p>
</div>
<p>RADOS provides a number of ways for you to set the required values. For
the monitor and encryption key settings, an easy way to handle them is to ensure
that your Ceph configuration file contains a <tt class="docutils literal"><span class="pre">keyring</span></tt> path to a keyring file
and at least one monitor address (e.g,. <tt class="docutils literal"><span class="pre">mon</span> <span class="pre">host</span></tt>). For example:</p>
<div class="highlight-python"><pre>[global]
mon host = 192.168.1.1
keyring = /etc/ceph/ceph.client.admin.keyring</pre>
</div>
<p>Once you create the handle, you can read a Ceph configuration file to configure
the handle. You can also pass arguments to your app and parse them with the
function for parsing command line arguments (e.g., <tt class="docutils literal"><span class="pre">rados_conf_parse_argv()</span></tt>),
or parse Ceph environment variables (e.g., <tt class="docutils literal"><span class="pre">rados_conf_parse_env()</span></tt>). Some
wrappers may not implement convenience methods, so you may need to implement
these capabilities. The following diagram provides a high-level flow for the
initial connection.</p>
<p class="ditaa">
<img src="../../../_images/ditaa-bd1070de50515485f116a874684956bc7e26c664.png"/>
</p>
<p>Once connected, your app can invoke functions that affect the whole cluster
with only the cluster handle. For example, once you have a cluster
handle, you can:</p>
<ul class="simple">
<li>Get cluster statistics</li>
<li>Use Pool Operation (exists, create, list, delete)</li>
<li>Get and set the configuration</li>
</ul>
<p>One of the powerful features of Ceph is the ability to bind to different pools.
Each pool may have a different number of placement groups, object replicas and
replication strategies. For example, a pool could be set up as a &#8220;hot&#8221; pool that
uses SSDs for frequently used objects or a &#8220;cold&#8221; pool that uses erasure coding.</p>
<p>The main difference in the various <tt class="docutils literal"><span class="pre">librados</span></tt> bindings is between C and
the object-oriented bindings for C++, Java and Python. The object-oriented
bindings use objects to represent cluster handles, IO Contexts, iterators,
exceptions, etc.</p>
<div class="section" id="c-example">
<h3>C Example<a class="headerlink" href="#c-example" title="Permalink to this headline">¶</a></h3>
<p>For C, creating a simple cluster handle using the <tt class="docutils literal"><span class="pre">admin</span></tt> user, configuring
it and connecting to the cluster might look something like this:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="cp">#include &lt;rados/librados.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="n">argv</span><span class="o">**</span><span class="p">)</span>
<span class="p">{</span>

        <span class="cm">/* Declare the cluster handle and required arguments. */</span>
        <span class="kt">rados_t</span> <span class="n">cluster</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">cluster_name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;ceph&quot;</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">user_name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;client.admin&quot;</span><span class="p">;</span>
        <span class="kt">uint64_t</span> <span class="n">flags</span><span class="p">;</span>

        <span class="cm">/* Initialize the cluster handle with the &quot;ceph&quot; cluster name and the &quot;client.admin&quot; user */</span>
        <span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_create2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cluster</span><span class="p">,</span> <span class="n">cluster_name</span><span class="p">,</span> <span class="n">user_name</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Couldn&#39;t create the cluster handle! %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Created a cluster handle.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>


        <span class="cm">/* Read a Ceph configuration file to configure the cluster handle. */</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_conf_read_file</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="s">&quot;/etc/ceph/ceph.conf&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: cannot read config file: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Read the config file.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/* Read command line arguments */</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_conf_parse_argv</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: cannot parse command line arguments: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Read the command line arguments.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/* Connect to the cluster */</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_connect</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: cannot connect to cluster: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Connected to the cluster.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Compile your client and link to <tt class="docutils literal"><span class="pre">librados</span></tt> using <tt class="docutils literal"><span class="pre">-lrados</span></tt>. For example:</p>
<div class="highlight-python"><pre>gcc ceph-client.c -lrados -o ceph-client</pre>
</div>
</div>
<div class="section" id="id3">
<h3>C++ Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The Ceph project provides a C++ example in the <tt class="docutils literal"><span class="pre">ceph/examples/librados</span></tt>
directory. For C++, a simple cluster handle using the <tt class="docutils literal"><span class="pre">admin</span></tt> user requires
you to initialize a <tt class="docutils literal"><span class="pre">librados::Rados</span></tt> cluster handle object:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;string&gt;</span>
<span class="cp">#include &lt;rados/librados.hpp&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>

        <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="cm">/* Declare the cluster handle and required variables. */</span>
        <span class="n">librados</span><span class="o">::</span><span class="n">Rados</span> <span class="n">cluster</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">cluster_name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;ceph&quot;</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">user_name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;client.admin&quot;</span><span class="p">;</span>
        <span class="kt">uint64_t</span> <span class="n">flags</span><span class="p">;</span>

        <span class="cm">/* Initialize the cluster handle with the &quot;ceph&quot; cluster name and &quot;client.admin&quot; user */</span>
        <span class="p">{</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="n">init2</span><span class="p">(</span><span class="n">user_name</span><span class="p">,</span> <span class="n">cluster_name</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t initialize the cluster handle! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
                        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Created a cluster handle.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>

        <span class="cm">/* Read a Ceph configuration file to configure the cluster handle. */</span>
        <span class="p">{</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="n">conf_read_file</span><span class="p">(</span><span class="s">&quot;/etc/ceph/ceph.conf&quot;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t read the Ceph configuration file! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
                        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Read the Ceph configuration file.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>

        <span class="cm">/* Read command line arguments */</span>
        <span class="p">{</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="n">conf_parse_argv</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t parse command line options! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
                        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Parsed command line options.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>

        <span class="cm">/* Connect to the cluster */</span>
        <span class="p">{</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="n">connect</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t connect to cluster! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
                        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Connected to the cluster.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compile the source; then, link <tt class="docutils literal"><span class="pre">librados</span></tt> using <tt class="docutils literal"><span class="pre">-lrados</span></tt>.
For example:</p>
<div class="highlight-python"><pre>g++ -g -c ceph-client.cc -o ceph-client.o
g++ -g ceph-client.o -lrados -o ceph-client</pre>
</div>
</div>
<div class="section" id="python-example">
<h3>Python Example<a class="headerlink" href="#python-example" title="Permalink to this headline">¶</a></h3>
<p>Python uses the <tt class="docutils literal"><span class="pre">admin</span></tt> id and the <tt class="docutils literal"><span class="pre">ceph</span></tt> cluster name by default, and
will read the standard <tt class="docutils literal"><span class="pre">ceph.conf</span></tt> file if the conffile parameter is
set to the empty string. The Python binding converts C++ errors
into exceptions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">rados</span>

<span class="k">try</span><span class="p">:</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">rados</span><span class="o">.</span><span class="n">Rados</span><span class="p">(</span><span class="n">conffile</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Argument validation error: &#39;</span><span class="p">,</span> <span class="n">e</span>
        <span class="k">raise</span> <span class="n">e</span>

<span class="k">print</span> <span class="s">&quot;Created cluster handle.&quot;</span>

<span class="k">try</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;connection error: &quot;</span><span class="p">,</span> <span class="n">e</span>
        <span class="k">raise</span> <span class="n">e</span>
<span class="k">finally</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Connected to the cluster.&quot;</span>
</pre></div>
</div>
<p>Execute the example to verify that it connects to your cluster.</p>
<div class="highlight-python"><pre>python ceph-client.py</pre>
</div>
</div>
<div class="section" id="java-example">
<h3>Java Example<a class="headerlink" href="#java-example" title="Permalink to this headline">¶</a></h3>
<p>Java requires you to specify the user ID (<tt class="docutils literal"><span class="pre">admin</span></tt>) or user name
(<tt class="docutils literal"><span class="pre">client.admin</span></tt>), and uses the <tt class="docutils literal"><span class="pre">ceph</span></tt> cluster name by default . The Java
binding converts C++-based errors into exceptions.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.ceph.rados.Rados</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ceph.rados.RadosException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CephClient</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]){</span>

                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">Rados</span> <span class="n">cluster</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rados</span><span class="o">(</span><span class="s">&quot;admin&quot;</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Created cluster handle.&quot;</span><span class="o">);</span>

                        <span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/etc/ceph/ceph.conf&quot;</span><span class="o">);</span>
                        <span class="n">cluster</span><span class="o">.</span><span class="na">confReadFile</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Read the configuration file.&quot;</span><span class="o">);</span>

                        <span class="n">cluster</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Connected to the cluster.&quot;</span><span class="o">);</span>

                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RadosException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getReturnValue</span><span class="o">());</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Compile the source; then, run it. If you have copied the JAR to
<tt class="docutils literal"><span class="pre">/usr/share/java</span></tt> and sym linked from your <tt class="docutils literal"><span class="pre">ext</span></tt> directory, you won&#8217;t need
to specify the classpath. For example:</p>
<div class="highlight-python"><pre>javac CephClient.java
java CephClient</pre>
</div>
</div>
<div class="section" id="php">
<h3>PHP 实例<a class="headerlink" href="#php" title="Permalink to this headline">¶</a></h3>
<p>在启用了 RADOS 扩展的 PHP 上，新建集群句柄非常简单：</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$r</span> <span class="o">=</span> <span class="nx">rados_create</span><span class="p">();</span>
<span class="nx">rados_conf_read_file</span><span class="p">(</span><span class="nv">$r</span><span class="p">,</span> <span class="s1">&#39;/etc/ceph/ceph.conf&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">rados_connect</span><span class="p">(</span><span class="nv">$r</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;Failed to connect to Ceph cluster&quot;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;Successfully connected to Ceph cluster&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>把上述内容保存为 rados.php 并运行：</p>
<div class="highlight-python"><pre>php rados.php</pre>
</div>
</div>
</div>
<div class="section" id="step-3-creating-an-i-o-context">
<h2>Step 3: Creating an I/O Context<a class="headerlink" href="#step-3-creating-an-i-o-context" title="Permalink to this headline">¶</a></h2>
<p>Once your app has a cluster handle and a connection to a Ceph Storage Cluster,
you may create an I/O Context and begin reading and writing data. An I/O Context
binds the connection to a specific pool. The user must have appropriate
<a class="reference external" href="../../operations/auth-intro#ceph-authorization-caps">CAPS</a> permissions to access the specified pool. For example, a user with read
access but not write access will only be able to read data. I/O Context
functionality includes:</p>
<ul class="simple">
<li>Write/read data and extended attributes</li>
<li>List and iterate over objects and extended attributes</li>
<li>Snapshot pools, list snapshots, etc.</li>
</ul>
<p class="ditaa">
<img src="../../../_images/ditaa-186075203a47d104deed70373affeb15ec7dc9c8.png"/>
</p>
<p>RADOS enables you to interact both synchronously and asynchronously. Once your
app has an I/O Context, read/write operations only require you to know the
object/xattr name. The CRUSH algorithm encapsulated in <tt class="docutils literal"><span class="pre">librados</span></tt> uses the
cluster map to identify the appropriate OSD. OSD daemons handle the replication,
as described in <a class="reference external" href="../../../architecture#smart-daemons-enable-hyperscale">Smart Daemons Enable Hyperscale</a>. The <tt class="docutils literal"><span class="pre">librados</span></tt> library also
maps objects to placement groups, as described in  <a class="reference external" href="../../../architecture#calculating-pg-ids">Calculating PG IDs</a>.</p>
<p>The following examples use the default <tt class="docutils literal"><span class="pre">data</span></tt> pool. However, you may also
use the API to list pools, ensure they exist, or create and delete pools. For
the write operations, the examples illustrate how to use synchronous mode. For
the read operations, the examples illustrate how to use asynchronous mode.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Use caution when deleting pools with this API. If you delete
a pool, the pool and ALL DATA in the pool will be lost.</p>
</div>
<div class="section" id="id4">
<h3>C Example<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="cp">#include &lt;rados/librados.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">argv</span><span class="o">**</span><span class="p">)</span>
<span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">         * Continued from previous C example, where cluster handle and</span>
<span class="cm">         * connection are established. First declare an I/O Context.</span>
<span class="cm">         */</span>

        <span class="kt">rados_ioctx_t</span> <span class="n">io</span><span class="p">;</span>
        <span class="kt">char</span> <span class="o">*</span><span class="n">poolname</span> <span class="o">=</span> <span class="s">&quot;data&quot;</span><span class="p">;</span>

        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_ioctx_create</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">poolname</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">io</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: cannot open rados pool %s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poolname</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Created I/O context.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/* Write data to the cluster synchronously. */</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_write</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Cannot write object </span><span class="se">\&quot;</span><span class="s">hw</span><span class="se">\&quot;</span><span class="s"> to pool %s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poolname</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">rados_ioctx_destroy</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>
                <span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Wrote </span><span class="se">\&quot;</span><span class="s">Hello World</span><span class="se">\&quot;</span><span class="s"> to object </span><span class="se">\&quot;</span><span class="s">hw</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">char</span> <span class="n">xattr</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;en_US&quot;</span><span class="p">;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_setxattr</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">,</span> <span class="n">xattr</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Cannot write xattr to pool %s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poolname</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">rados_ioctx_destroy</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>
                <span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Wrote </span><span class="se">\&quot;</span><span class="s">en_US</span><span class="se">\&quot;</span><span class="s"> to xattr </span><span class="se">\&quot;</span><span class="s">lang</span><span class="se">\&quot;</span><span class="s"> for object </span><span class="se">\&quot;</span><span class="s">hw</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/*</span>
<span class="cm">         * Read data from the cluster asynchronously.</span>
<span class="cm">         * First, set up asynchronous I/O completion.</span>
<span class="cm">         */</span>
        <span class="kt">rados_completion_t</span> <span class="n">comp</span><span class="p">;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_aio_create_completion</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comp</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Could not create aio completion: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">rados_ioctx_destroy</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>
                <span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Created AIO completion.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/* Next, read data using rados_aio_read. */</span>
        <span class="kt">char</span> <span class="n">read_res</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_aio_read</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">read_res</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Cannot read object. %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poolname</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">rados_ioctx_destroy</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>
                <span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Read object </span><span class="se">\&quot;</span><span class="s">hw</span><span class="se">\&quot;</span><span class="s">. The contents are:</span><span class="se">\n</span><span class="s"> %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">read_res</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/* Wait for the operation to complete */</span>
        <span class="n">rados_wait_for_complete</span><span class="p">(</span><span class="n">comp</span><span class="p">);</span>

        <span class="cm">/* Release the asynchronous I/O complete handle to avoid memory leaks. */</span>
        <span class="n">rados_aio_release</span><span class="p">(</span><span class="n">comp</span><span class="p">);</span>


        <span class="kt">char</span> <span class="n">xattr_res</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_getxattr</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">,</span> <span class="n">xattr_res</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Cannot read xattr. %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poolname</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">rados_ioctx_destroy</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>
                <span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Read xattr </span><span class="se">\&quot;</span><span class="s">lang</span><span class="se">\&quot;</span><span class="s"> for object </span><span class="se">\&quot;</span><span class="s">hw</span><span class="se">\&quot;</span><span class="s">. The contents are:</span><span class="se">\n</span><span class="s"> %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">xattr_res</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_rmxattr</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Cannot remove xattr. %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poolname</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">rados_ioctx_destroy</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>
                <span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Removed xattr </span><span class="se">\&quot;</span><span class="s">lang</span><span class="se">\&quot;</span><span class="s"> for object </span><span class="se">\&quot;</span><span class="s">hw</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">err</span> <span class="o">=</span> <span class="n">rados_remove</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s">&quot;hw&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;%s: Cannot remove object. %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poolname</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="o">-</span><span class="n">err</span><span class="p">));</span>
                <span class="n">rados_ioctx_destroy</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>
                <span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Removed object </span><span class="se">\&quot;</span><span class="s">hw</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>C++ Example<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;string&gt;</span>
<span class="cp">#include &lt;rados/librados.hpp&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>

        <span class="cm">/* Continued from previous C++ example, where cluster handle and</span>
<span class="cm">         * connection are established. First declare an I/O Context.</span>
<span class="cm">         */</span>

        <span class="n">librados</span><span class="o">::</span><span class="n">IoCtx</span> <span class="n">io_ctx</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pool_name</span> <span class="o">=</span> <span class="s">&quot;data&quot;</span><span class="p">;</span>

        <span class="p">{</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="n">ioctx_create</span><span class="p">(</span><span class="n">pool_name</span><span class="p">,</span> <span class="n">io_ctx</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t set up ioctx! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Created an ioctx for the pool.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>


        <span class="cm">/* Write an object synchronously. */</span>
        <span class="p">{</span>
                <span class="n">librados</span><span class="o">::</span><span class="n">bufferlist</span> <span class="n">bl</span><span class="p">;</span>
                <span class="n">bl</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">);</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">io_ctx</span><span class="p">.</span><span class="n">write_full</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="n">bl</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t write object! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Wrote new object &#39;hw&#39; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>


        <span class="cm">/*</span>
<span class="cm">         * Add an xattr to the object.</span>
<span class="cm">         */</span>
        <span class="p">{</span>
                <span class="n">librados</span><span class="o">::</span><span class="n">bufferlist</span> <span class="n">lang_bl</span><span class="p">;</span>
                <span class="n">lang_bl</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">);</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">io_ctx</span><span class="p">.</span><span class="n">setxattr</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">,</span> <span class="n">lang_bl</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;failed to set xattr version entry! error &quot;</span>
                        <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Set the xattr &#39;lang&#39; on our object!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>


        <span class="cm">/*</span>
<span class="cm">         * Read the object back asynchronously.</span>
<span class="cm">         */</span>
        <span class="p">{</span>
                <span class="n">librados</span><span class="o">::</span><span class="n">bufferlist</span> <span class="n">read_buf</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">read_len</span> <span class="o">=</span> <span class="mi">4194304</span><span class="p">;</span>

                <span class="c1">//Create I/O Completion.</span>
                <span class="n">librados</span><span class="o">::</span><span class="n">AioCompletion</span> <span class="o">*</span><span class="n">read_completion</span> <span class="o">=</span> <span class="n">librados</span><span class="o">::</span><span class="n">Rados</span><span class="o">::</span><span class="n">aio_create_completion</span><span class="p">();</span>

                <span class="c1">//Send read request.</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">io_ctx</span><span class="p">.</span><span class="n">aio_read</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="n">read_completion</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">read_buf</span><span class="p">,</span> <span class="n">read_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t start read object! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// Wait for the request to complete, and check that it succeeded.</span>
                <span class="n">read_completion</span><span class="o">-&gt;</span><span class="n">wait_for_complete</span><span class="p">();</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">read_completion</span><span class="o">-&gt;</span><span class="n">get_return_value</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t read object! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Read object hw asynchronously with contents.</span><span class="se">\n</span><span class="s">&quot;</span>
                        <span class="o">&lt;&lt;</span> <span class="n">read_buf</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>


        <span class="cm">/*</span>
<span class="cm">         * Read the xattr.</span>
<span class="cm">         */</span>
        <span class="p">{</span>
                <span class="n">librados</span><span class="o">::</span><span class="n">bufferlist</span> <span class="n">lang_res</span><span class="p">;</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">io_ctx</span><span class="p">.</span><span class="n">getxattr</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">,</span> <span class="n">lang_res</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;failed to get xattr version entry! error &quot;</span>
                        <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Got the xattr &#39;lang&#39; from object hw!&quot;</span>
                        <span class="o">&lt;&lt;</span> <span class="n">lang_res</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>


        <span class="cm">/*</span>
<span class="cm">         * Remove the xattr.</span>
<span class="cm">         */</span>
        <span class="p">{</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">io_ctx</span><span class="p">.</span><span class="n">rmxattr</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Failed to remove xattr! error &quot;</span>
                        <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Removed the xattr &#39;lang&#39; from our object!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>

        <span class="cm">/*</span>
<span class="cm">         * Remove the object.</span>
<span class="cm">         */</span>
        <span class="p">{</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">io_ctx</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t remove object! error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Removed object &#39;hw&#39;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Python Example<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">I/O Context and Object Operations&quot;</span>
<span class="k">print</span> <span class="s">&quot;=================================&quot;</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Creating a context for the &#39;data&#39; pool&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">cluster</span><span class="o">.</span><span class="n">pool_exists</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;No data pool exists&#39;</span><span class="p">)</span>
<span class="n">ioctx</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">open_ioctx</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Writing object &#39;hw&#39; with contents &#39;Hello World!&#39; to pool &#39;data&#39;.&quot;</span>
<span class="n">ioctx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Writing XATTR &#39;lang&#39; with value &#39;en_US&#39; to object &#39;hw&#39;&quot;</span>
<span class="n">ioctx</span><span class="o">.</span><span class="n">set_xattr</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">,</span> <span class="s">&quot;en_US&quot;</span><span class="p">)</span>


<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Writing object &#39;bm&#39; with contents &#39;Bonjour tout le monde!&#39; to pool &#39;data&#39;.&quot;</span>
<span class="n">ioctx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;bm&quot;</span><span class="p">,</span> <span class="s">&quot;Bonjour tout le monde!&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Writing XATTR &#39;lang&#39; with value &#39;fr_FR&#39; to object &#39;bm&#39;&quot;</span>
<span class="n">ioctx</span><span class="o">.</span><span class="n">set_xattr</span><span class="p">(</span><span class="s">&quot;bm&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">,</span> <span class="s">&quot;fr_FR&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Contents of object &#39;hw&#39;</span><span class="se">\n</span><span class="s">------------------------&quot;</span>
<span class="k">print</span> <span class="n">ioctx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">Getting XATTR &#39;lang&#39; from object &#39;hw&#39;&quot;</span>
<span class="k">print</span> <span class="n">ioctx</span><span class="o">.</span><span class="n">get_xattr</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Contents of object &#39;bm&#39;</span><span class="se">\n</span><span class="s">------------------------&quot;</span>
<span class="k">print</span> <span class="n">ioctx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;bm&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Getting XATTR &#39;lang&#39; from object &#39;bm&#39;&quot;</span>
<span class="k">print</span> <span class="n">ioctx</span><span class="o">.</span><span class="n">get_xattr</span><span class="p">(</span><span class="s">&quot;bm&quot;</span><span class="p">,</span> <span class="s">&quot;lang&quot;</span><span class="p">)</span>


<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Removing object &#39;hw&#39;&quot;</span>
<span class="n">ioctx</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="s">&quot;hw&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Removing object &#39;bm&#39;&quot;</span>
<span class="n">ioctx</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="s">&quot;bm&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>Java-Example<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.ceph.rados.Rados</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ceph.rados.RadosException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ceph.rados.IoCTX</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CephClient</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]){</span>

                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">Rados</span> <span class="n">cluster</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rados</span><span class="o">(</span><span class="s">&quot;admin&quot;</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Created cluster handle.&quot;</span><span class="o">);</span>

                        <span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/etc/ceph/ceph.conf&quot;</span><span class="o">);</span>
                        <span class="n">cluster</span><span class="o">.</span><span class="na">confReadFile</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Read the configuration file.&quot;</span><span class="o">);</span>

                        <span class="n">cluster</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Connected to the cluster.&quot;</span><span class="o">);</span>

                        <span class="n">IoCTX</span> <span class="n">io</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="na">ioCtxCreate</span><span class="o">(</span><span class="s">&quot;data&quot;</span><span class="o">);</span>

                        <span class="n">String</span> <span class="n">oidone</span> <span class="o">=</span> <span class="s">&quot;hw&quot;</span><span class="o">;</span>
                        <span class="n">String</span> <span class="n">contentone</span> <span class="o">=</span> <span class="s">&quot;Hello World!&quot;</span><span class="o">;</span>
                        <span class="n">io</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">oidone</span><span class="o">,</span> <span class="n">contentone</span><span class="o">);</span>

                        <span class="n">String</span> <span class="n">oidtwo</span> <span class="o">=</span> <span class="s">&quot;bm&quot;</span><span class="o">;</span>
                        <span class="n">String</span> <span class="n">contenttwo</span> <span class="o">=</span> <span class="s">&quot;Bonjour tout le monde!&quot;</span><span class="o">;</span>
                        <span class="n">io</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">oidtwo</span><span class="o">,</span> <span class="n">contenttwo</span><span class="o">);</span>

                        <span class="n">String</span><span class="o">[]</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="na">listObjects</span><span class="o">();</span>
                        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">object</span><span class="o">:</span> <span class="n">objects</span><span class="o">)</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>

                        <span class="n">io</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">oidone</span><span class="o">);</span>
                        <span class="n">io</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">oidtwo</span><span class="o">);</span>

                        <span class="n">cluster</span><span class="o">.</span><span class="na">ioCtxDestroy</span><span class="o">(</span><span class="n">io</span><span class="o">);</span>

                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RadosException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getReturnValue</span><span class="o">());</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>PHP 实例<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$io</span> <span class="o">=</span> <span class="nx">rados_ioctx_create</span><span class="p">(</span><span class="nv">$r</span><span class="p">,</span> <span class="s2">&quot;mypool&quot;</span><span class="p">);</span>
<span class="nx">rados_write_full</span><span class="p">(</span><span class="nv">$io</span><span class="p">,</span> <span class="s2">&quot;oidOne&quot;</span><span class="p">,</span> <span class="s2">&quot;mycontents&quot;</span><span class="p">);</span>
<span class="nx">rados_remove</span><span class="p">(</span><span class="s2">&quot;oidOne&quot;</span><span class="p">);</span>
<span class="nx">rados_ioctx_destroy</span><span class="p">(</span><span class="nv">$io</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-4-closing-sessions">
<h2>Step 4: Closing Sessions<a class="headerlink" href="#step-4-closing-sessions" title="Permalink to this headline">¶</a></h2>
<p>Once your app finishes with the I/O Context and cluster handle, the app should
close the connection and shutdown the handle. For asynchronous I/O, the app
should also ensure that pending asynchronous operations have completed.</p>
<div class="section" id="id9">
<h3>C Example<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c"><div class="highlight"><pre><span class="n">rados_ioctx_destroy</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>
<span class="n">rados_shutdown</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>C++ Example<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">io_ctx</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="n">cluster</span><span class="p">.</span><span class="n">shutdown</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>Python Example<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Closing the connection.&quot;</span>
<span class="n">ioctx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">print</span> <span class="s">&quot;Shutting down the handle.&quot;</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>PHP 实例<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span class="x">rados_shutdown($r);</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/">安装（快速）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">安装（手动）</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Ceph 存储集群</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../configuration/">配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../deployment/">部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/">运维</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/">手册页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting/">故障排除</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">APIs</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="">librados 简介</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">第一步：获取 librados</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#getting-librados-for-c-c">Getting librados for C/C++</a></li>
<li class="toctree-l5"><a class="reference internal" href="#librados-python">获取 librados 的 Python 支持</a></li>
<li class="toctree-l5"><a class="reference internal" href="#librados-java">获取 librados 的 Java 支持</a></li>
<li class="toctree-l5"><a class="reference internal" href="#librados-php">获取 librados 的 PHP 绑定</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id2">第二步：配置集群句柄</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#c-example">C Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id3">C++ Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#python-example">Python Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#java-example">Java Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#php">PHP 实例</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-creating-an-i-o-context">Step 3: Creating an I/O Context</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id4">C Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id5">C++ Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id6">Python Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id7">Java-Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id8">PHP 实例</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-closing-sessions">Step 4: Closing Sessions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id9">C Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id10">C++ Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id11">Python Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id12">PHP 实例</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../librados/">librados (C)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../libradospp/">librados (C++)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python/">librados (Python)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/">开发文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph 版本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Ceph 术语</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../librados/" title="Librados (C)"
             >next</a> |</li>
        <li class="right" >
          <a href="../" title="Ceph 存储集群 API"
             >previous</a> |</li>
        <li><a href="../../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../../" >Ceph 存储集群</a> &raquo;</li>
          <li><a href="../" >Ceph 存储集群 API</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2014, Inktank Storage, Inc. and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>
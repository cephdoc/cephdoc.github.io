
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>监视器配置参考 &mdash; Ceph Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Ceph Documentation" href="../../../" />
    <link rel="up" title="配置" href="../" />
    <link rel="next" title="监视器与 OSD 交互的配置" href="../mon-osd-interaction/" />
    <link rel="prev" title="Cephx 配置参考" href="../auth-config-ref/" />
    <script type="text/javascript" src="http://ayni.ceph.com/public/js/ceph.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../mon-osd-interaction/" title="监视器与 OSD 交互的配置"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../auth-config-ref/" title="Cephx 配置参考"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../../" >Ceph 存储集群</a> &raquo;</li>
          <li><a href="../" accesskey="U">配置</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>监视器配置参考<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>理解如何配置 <a class="reference internal" href="../../../glossary/#term-59"><em class="xref std std-term">Ceph 监视器</em></a>是构建可靠的 <a class="reference internal" href="../../../glossary/#term-21"><em class="xref std std-term">Ceph 存储集群</em></a>的重要方面，<strong>任何 Ceph 集群都需要至少一个监视器</strong>。一个监视器通常相当一致，但是你可以增加、删除、或替换集群中的监视器，详情见<a class="reference external" href="../../operations/add-or-rm-mons">增加/删除监视器</a>和<a class="reference external" href="../../deployment/ceph-deploy-mon">增加/删除监视器（ ceph-deploy ）</a> 。</p>
<div class="section" id="index-0">
<span id="id2"></span><h2>背景<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h2>
<p>监视器们维护着集群运行图的“主副本”，就是说客户端连到一个监视器并获取当前运行图就能确定所有监视器、 OSD 和元数据服务器的位置。 Ceph 客户端读写 OSD 或元数据服务器前，必须先连到一个监视器，靠当前集群运行图的副本和 CRUSH 算法，客户端能计算出任何对象的位置，故此客户端有能力直接连到 OSD ，这对 Ceph 的高伸缩性、高性能来说非常重要。更多信息见<a class="reference external" href="../../../architecture#scalability-and-high-availability">伸缩性和高可用性</a>。</p>
<p>监视器的主要角色是维护集群运行图的主副本，它也提供认证和日志记录服务。 Ceph 监视器们把监视器服务的所有更改写入一个单独的 Paxos 例程，然后 Paxos 以键/值方式存储所有变更以实现高度一致性。同步期间， Ceph 监视器能查询集群运行图的近期版本，它们通过操作键/值存储快照和迭代器（用 leveldb ）来进行存储级同步。</p>
<p class="ditaa">
<img src="../../../_images/ditaa-ae8fc6ae5b4014f064a0bed424507a7a247cd113.png"/>
</p>
<p class="deprecated">
<span class="versionmodified">Deprecated since version 0.58: </span>版</p>
<p>在 0.58 及更早版本中， Ceph 监视器每个服务用一个 Paxos 例程，并把运行图存储为文件。</p>
<div class="section" id="index-1">
<span id="id3"></span><h3>集群运行图<a class="headerlink" href="#index-1" title="Permalink to this headline">¶</a></h3>
<p>集群运行图是多个图的组合，包括监视器图、 OSD 图、归置组图和元数据服务器图。集群运行图追踪几个重要事件：哪些进程在集群里（ <tt class="docutils literal"><span class="pre">in</span></tt> ）；哪些进程在集群里（ <tt class="docutils literal"><span class="pre">in</span></tt> ）是 <tt class="docutils literal"><span class="pre">up</span></tt> 且在运行、或 <tt class="docutils literal"><span class="pre">down</span></tt> ；归置组状态是 <tt class="docutils literal"><span class="pre">active</span></tt> 或 <tt class="docutils literal"><span class="pre">inactive</span></tt> 、 <tt class="docutils literal"><span class="pre">clean</span></tt> 或其他状态；和其他反映当前集群状态的信息，像总存储容量、和使用量。</p>
<p>当集群状态有明显变更时，如一 OSD 挂了、一归置组降级了等等，集群运行图会被更新以反映集群当前状态。另外，监视器也维护着集群的主要状态历史。监视器图、 OSD 图、归置组图和元数据服务器图各自维护着它们的运行图版本。我们把各图的版本称为一个 epoch 。</p>
<p>运营集群时，跟踪这些状态是系统管理任务的重要部分。详情见<a class="reference external" href="../../operations/monitoring">监控集群</a>和<a class="reference external" href="../../operations/monitoring-osd-pg">监控 OSD 和归置组</a>。</p>
</div>
<div class="section" id="index-2">
<span id="id4"></span><h3>监视器法定人数<a class="headerlink" href="#index-2" title="Permalink to this headline">¶</a></h3>
<p>本文入门部分提供了一个简陋的 <a class="reference external" href="../../../start/quick-start/#add-a-configuration-file">Ceph 配置文件</a>，它提供了一个监视器用于测试。只用一个监视器集群可以良好地运行，然而<strong>单监视器是一个单故障点</strong>，生产集群要实现高可用性的话得配置多个监视器，这样单个监视器的失效才<strong>不会</strong>影响整个集群。</p>
<p>集群用多个监视器实现高可用性时，多个监视器用 <a class="reference external" href="http://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos</a> 算法对主集群运行图达成一致，这里的一致要求大多数监视器都在运行且够成法定人数（如 1 个、 3 之 2 在运行、 5 之 3 、 6 之 4 等等）。</p>
</div>
<div class="section" id="index-3">
<span id="id5"></span><h3>一致性<a class="headerlink" href="#index-3" title="Permalink to this headline">¶</a></h3>
<p>你把监视器加进 Ceph 配置文件时，得注意一些架构问题， Ceph 发现集群内的其他监视器时对其有着<strong>严格的一致性要求</strong>。尽管如此， Ceph 客户端和其他 Ceph 守护进程用配置文件发现监视器，监视器却用监视器图（ monmap ）相互发现而非配置文件。</p>
<p>一个监视器发现集群内的其他监视器时总是参考 monmap 的本地副本，用 monmap 而非 Ceph 配置文件避免了可能损坏集群的错误（如 <tt class="docutils literal"><span class="pre">ceph.conf</span></tt> 中指定地址或端口的拼写错误）。正因为监视器把 monmap 用于发现、并共享于客户端和其他 Ceph 守护进程间， <strong>monmap可严格地保证监视器的一致性是可靠的</strong>。</p>
<p>严格的一致性也适用于 monmap 的更新，因为关于监视器的任何更新、关于 monmap 的变更都是通过称为 <a class="reference external" href="http://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos</a> 的分布式一致性算法传递的。监视器们必须就 monmap 的每次更新达成一致，以确保法定人数里的每个监视器 monmap 版本相同，如增加、删除一个监视器。 monmap 的更新是增量的，所以监视器们都有最新的一致版本，以及一系列之前版本。历史版本的存在允许一个落后的监视器跟上集群当前状态。</p>
<p>如果监视器通过配置文件而非 monmap 相互发现，这会引进其他风险，因为 Ceph 配置文件不是自动更新并分发的，监视器有可能不小心用了较老的配置文件，以致于不认识某监视器、放弃法定人数、或者产生一种 <a class="reference external" href="http://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos</a> 不能确定当前系统状态的情形。</p>
</div>
<div class="section" id="index-4">
<span id="id6"></span><h3>初始化监视器<a class="headerlink" href="#index-4" title="Permalink to this headline">¶</a></h3>
<p>在大多数配置和部署案例中，部署 Ceph 的工具可以帮你生成一个监视器图来初始化监视器（如 <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt> 等），一个监视器需要 4 个选项：</p>
<ul class="simple">
<li><strong>文件系统标识符：</strong> <tt class="docutils literal"><span class="pre">fsid</span></tt> 是对象存储的唯一标识符。因为你可以在一套硬件上运行多个集群，所以在初始化监视器时必须指定对象存储的唯一标识符。部署工具通常可替你完成（如 <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt> 会调用类似 <tt class="docutils literal"><span class="pre">uuidgen</span></tt> 的程序），但是你也可以手动指定 <tt class="docutils literal"><span class="pre">fsid</span></tt> 。</li>
<li><strong>监视器标识符：</strong> 监视器标识符是分配给集群内各监视器的唯一 ID ，它是一个字母数字组合，为方便起见，标识符通常以字母顺序结尾（如 <tt class="docutils literal"><span class="pre">a</span></tt> 、 <tt class="docutils literal"><span class="pre">b</span></tt> 等等），可以设置于 Ceph 配置文件（如 <tt class="docutils literal"><span class="pre">[mon.a]</span></tt> 、 <tt class="docutils literal"><span class="pre">[mon.b]</span></tt> 等等）、部署工具、或 <tt class="docutils literal"><span class="pre">ceph</span></tt> 命令行工具。</li>
<li><strong>密钥：</strong> 监视器必须有密钥。像 <tt class="docutils literal"><span class="pre">ceph-deploy</span></tt> 这样的部署工具通常会自动生成，也可以手动完成。见<a class="reference external" href="../../operations/authentication#monitor-keyrings">监视器密钥环</a>。</li>
</ul>
<p>关于初始化的具体信息见<a class="reference external" href="../../../dev/mon-bootstrap">初始化监视器</a>。</p>
</div>
</div>
<div class="section" id="index-5">
<span id="id7"></span><h2>监视器的配置<a class="headerlink" href="#index-5" title="Permalink to this headline">¶</a></h2>
<p>要把配置应用到整个集群，把它们放到 <tt class="docutils literal"><span class="pre">[global]</span></tt> 下；要用于所有监视器，置于 <tt class="docutils literal"><span class="pre">[mon]</span></tt> 下；要用于某监视器，指定监视器例程，如 <tt class="docutils literal"><span class="pre">[mon.a]</span></tt> ）。按惯例，监视器例程用字母命名。</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[global]</span>

<span class="k">[mon]</span>

<span class="k">[mon.a]</span>

<span class="k">[mon.b]</span>

<span class="k">[mon.c]</span>
</pre></div>
</div>
<div class="section" id="id8">
<h3>最小配置<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Ceph 监视器的最简配置必须包括一主机名及其监视器地址，这些配置可置于 <tt class="docutils literal"><span class="pre">[mon]</span></tt> 下或某个监视器下。</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[mon]</span>
        <span class="na">mon host</span> <span class="o">=</span> <span class="s">hostname1,hostname2,hostname3</span>
<span class="s">        mon addr = 10.0.0.10:6789,10.0.0.11:6789,10.0.0.12:6789</span>
</pre></div>
</div>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[mon.a]</span>
        <span class="na">host</span> <span class="o">=</span> <span class="s">hostname1</span>
<span class="s">        mon addr = 10.0.0.10:6789</span>
</pre></div>
</div>
<p>详情见<a class="reference external" href="../network-config-ref">网络配置参考</a>。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这里的监视器最简配置假设部署工具会自动给你生成 <tt class="docutils literal"><span class="pre">fsid</span></tt> 和 <tt class="docutils literal"><span class="pre">mon.</span></tt> 密钥。</p>
</div>
<p>一旦部署了 Ceph 集群，监视器 IP 地址<strong>不应该</strong>更改。然而，如果你决意要改，必须严格按照<a class="reference external" href="../../operations/add-or-rm-mons#changing-a-monitor-s-ip-address">更改监视器 IP 地址</a>来改。</p>
</div>
<div class="section" id="id">
<h3>集群 ID<a class="headerlink" href="#id" title="Permalink to this headline">¶</a></h3>
<p>每个 Ceph 存储集群都有一个唯一标识符（ <tt class="docutils literal"><span class="pre">fsid</span></tt> ）。如果指定了，它应该出现在配置文件的 <tt class="docutils literal"><span class="pre">[global]</span></tt> 段下。部署工具通常会生成 <tt class="docutils literal"><span class="pre">fsid</span></tt> 并存于监视器图，所以不一定会写入配置文件， <tt class="docutils literal"><span class="pre">fsid</span></tt> 使得在一套硬件上运行多个集群成为可能。</p>
<p><tt class="docutils literal"><span class="pre">fsid</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">集群 ID ，一集群一个。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">UUID</td>
</tr>
<tr class="field-odd field"><th class="field-name">是否必需:</th><td class="field-body">Yes.</td>
</tr>
<tr class="field-even field"><th class="field-name">默认值:</th><td class="field-body">无。若未指定，部署工具会生成。</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果你用部署工具就不能设置。</p>
</div>
</div>
<div class="section" id="index-6">
<span id="id9"></span><h3>初始成员<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h3>
<p>我们建议在生产环境下最少部署 3 个监视器，以确保高可用性。运行多个监视器时，你可以指定为形成法定人数成员所需的初始监视器，这能减小集群上线时间。</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[mon]</span>
        <span class="na">mon initial members</span> <span class="o">=</span> <span class="s">a,b,c</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">initial</span> <span class="pre">members</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">集群启动时初始监视器的 ID ，若指定， Ceph 需要奇数个监视器来确定最初法定人数（如 3 ）。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">String</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">集群内的<em>大多数</em>监视器必须能互通以建立法定人数，你可以用此选项减小初始监视器数量来形成。</p>
</div>
</div>
<div class="section" id="index-7">
<span id="id10"></span><h3>数据<a class="headerlink" href="#index-7" title="Permalink to this headline">¶</a></h3>
<p>Ceph 监视器有存储数据的默认路径，生产集群为实现更高性能可把监视器部署到非 OSD 节点的独立主机上。因为监视器会频繁 <tt class="docutils literal"><span class="pre">fsync()</span></tt> ，这可能影响 OSD 。</p>
<p>在 Ceph 0.58 及更早版本中，监视器数据以文件保存，这样人们可以用 <tt class="docutils literal"><span class="pre">ls</span></tt> 和 <tt class="docutils literal"><span class="pre">cat</span></tt> 这些普通工具检查监视器数据，然而它不能提供健壮的一致性。</p>
<p>在 Ceph 0.59 及后续版本中，监视器以键/值对存储数据。监视器需要 <a class="reference external" href="http://en.wikipedia.org/wiki/ACID">ACID</a> 事务，数据存储的使用可防止监视器用损坏的版本进行恢复，除此之外，它允许在一个原子批量操作中进行多个修改操作。</p>
<p>一般来说我们不建议更改默认数据位置，如果要改，我们建议所有监视器统一配置，加到配置文件的 <tt class="docutils literal"><span class="pre">[mon]</span></tt> 下。</p>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">data</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器的数据位置。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">String</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">/var/lib/ceph/mon/$cluster-$id</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="index-8">
<span id="id11"></span><h3>存储容量<a class="headerlink" href="#index-8" title="Permalink to this headline">¶</a></h3>
<p>Ceph 存储集群利用率接近最大容量时（即 <tt class="docutils literal"><span class="pre">mon</span> <span class="pre">osd</span> <span class="pre">full</span> <span class="pre">ratio</span></tt> ），作为防止数据丢失的安全措施，它会阻止你读写 OSD 。因此，让生产集群用满可不是好事，因为牺牲了高可用性。 full ratio 默认值是 <tt class="docutils literal"><span class="pre">.95</span></tt> 或容量的 95% 。对小型测试集群来说这是非常激进的设置。</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">监控集群时，要警惕和 <tt class="docutils literal"><span class="pre">nearfull</span></tt> 相关的警告。这意味着一些 OSD 的失败会导致临时服务中断，应该增加一些 OSD 来扩展存储容量。</p>
</div>
<p>在测试集群时，一个常见场景是：系统管理员从集群删除一个 OSD 、接着观察重均衡；然后继续删除其他 OSD ，直到集群达到占满率并锁死。我们建议，即使在测试集群里也要规划一点空闲容量用于保证高可用性。理想情况下，要做好这样的预案：一系列 OSD 失败后，短时间内不更换它们仍能恢复到 <tt class="docutils literal"><span class="pre">active</span> <span class="pre">+</span> <span class="pre">clean</span></tt> 状态。你也可以在 <tt class="docutils literal"><span class="pre">active</span> <span class="pre">+</span> <span class="pre">degraded</span></tt> 状态运行集群，但对正常使用来说并不好。</p>
<p>下图描述了一个简化的 Ceph 集群，它包含 33 个节点、每主机一个 OSD 、每 OSD 3TB 容量，所以这个小白鼠集群有 99TB 的实际容量，其 <tt class="docutils literal"><span class="pre">mon</span> <span class="pre">osd</span> <span class="pre">full</span> <span class="pre">ratio</span></tt> 为 <tt class="docutils literal"><span class="pre">.95</span></tt> 。如果它只剩余 5TB 容量，集群就不允许客户端再读写数据，所以它的运行容量是 95TB ，而非 99TB 。</p>
<p class="ditaa">
<img src="../../../_images/ditaa-28056cd20c19e97a7617494fbc1cf0d761fb9da5.png"/>
</p>
<p>在这样的集群里，坏一或两个 OSD 很平常；一种罕见但可能发生的情形是一个机架的路由器或电源挂了，这会导致多个 OSD 同时离线（如 OSD 7-12 ），在这种情况下，你仍要力争保持集群可运行并达到 <tt class="docutils literal"><span class="pre">active</span> <span class="pre">+</span> <span class="pre">clean</span></tt> 状态，即使这意味着你得在短期内额外增加一些 OSD 及主机。如果集群利用率太高，在解决故障域期间也许不会丢数据，但很可能牺牲数据可用性，因为利用率超过了 full ratio 。故此，我们建议至少要粗略地规划下容量。</p>
<p>找出你集群的两个数字：</p>
<ol class="arabic simple">
<li>OSD 数量。</li>
<li>集群总容量。</li>
</ol>
<p>用集群里 OSD 总数除以集群总容量，就能得到 OSD 平均容量；如果按预计的 OSD 数乘以这个值所得的结果计算（偏小），实际应用时将出错；最后再用集群容量乘以占满率能得到最大运行容量，然后扣除预估的 OSD 失败率；用较高的失败率（如整机架的 OSD ）重复前述过程看是否接近占满率。</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[global]</span>

        <span class="na">mon osd full ratio</span> <span class="o">=</span> <span class="s">.80</span>
<span class="s">        mon osd nearfull ratio = .70</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">osd</span> <span class="pre">full</span> <span class="pre">ratio</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">OSD 硬盘使用率达到多少就认为它 <tt class="docutils literal"><span class="pre">full</span></tt> 。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">.95</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">osd</span> <span class="pre">nearfull</span> <span class="pre">ratio</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">OSD 硬盘使用率达到多少就认为它 <tt class="docutils literal"><span class="pre">nearfull</span></tt> 。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">.85</span></tt></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">如果一些 OSD 快满了，但其他的仍有足够空间，你可能配错 CRUSH 权重了。</p>
</div>
</div>
<div class="section" id="index-9">
<span id="id12"></span><h3>心跳<a class="headerlink" href="#index-9" title="Permalink to this headline">¶</a></h3>
<p>Ceph 监视器要求各 OSD 向它报告、并接收 OSD 们的邻居状态报告，以此来掌握集群。 Ceph 提供了监视器与 OSD 交互的合理默认值，然而你可以按需修改，详情见<a class="reference external" href="../mon-osd-interaction">监视器与 OSD 的交互</a>。</p>
</div>
<div class="section" id="index-10">
<span id="id13"></span><h3>监视器存储同步<a class="headerlink" href="#index-10" title="Permalink to this headline">¶</a></h3>
<p>当你用多个监视器支撑一个生产集群时，各监视器都要检查邻居是否有集群运行图的最新版本（如，邻居监视器的图有一或多个 epoch 版本高于当前监视器的最高版 epoch ），过一段时间，集群里的某个监视器可能落后于其它监视器太多而不得不离开法定人数，然后同步到集群当前状态，并重回法定人数。为了同步，监视器可能承担三种中的一种角色：</p>
<ol class="arabic simple">
<li><strong>Leader</strong>: <cite>Leader</cite> 是实现最新 Paxos 版本的第一个监视器。</li>
<li><strong>Provider</strong>: <cite>Provider</cite> 有最新集群运行图的监视器，但不是第一个实现最新版。</li>
<li><strong>Requester:</strong> <cite>Requester</cite> 落后于 leader ，重回法定人数前，必须同步以获取关于集群的最新信息。</li>
</ol>
<p>有了这些角色区分， leader就 可以给 provider 委派同步任务，这会避免同步请求压垮 leader 、影响性能。在下面的图示中， requester 已经知道它落后于其它监视器，然后向 leader 请求同步， leader 让它去和 provider 同步。</p>
<p class="ditaa">
<img src="../../../_images/ditaa-215fab4d12b3f0727a4fbc633b58887918820ca9.png"/>
</p>
<p>新监视器加入集群时有必要进行同步。在运行中，监视器会不定时收到集群运行图的更新，这就意味着 leader 和 provider 角色可能在监视器间变幻。如果这事发生在同步期间（如 provider 落后于 leader ）， provider 能终结和 requester 间的同步。</p>
<p>一旦同步完成， Ceph 需要修复整个集群，使归置组回到 <tt class="docutils literal"><span class="pre">active</span> <span class="pre">+</span> <span class="pre">clean</span></tt> 状态。</p>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">sync</span> <span class="pre">trim</span> <span class="pre">timeout</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body"></td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">30.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">sync</span> <span class="pre">heartbeat</span> <span class="pre">timeout</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body"></td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">30.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">sync</span> <span class="pre">heartbeat</span> <span class="pre">interval</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body"></td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">5.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">sync</span> <span class="pre">backoff</span> <span class="pre">timeout</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body"></td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">30.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">sync</span> <span class="pre">timeout</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body"></td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">30.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">sync</span> <span class="pre">max</span> <span class="pre">retries</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body"></td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">5</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">sync</span> <span class="pre">max</span> <span class="pre">payload</span> <span class="pre">size</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">同步载荷的最大尺寸。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">1045676</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">accept</span> <span class="pre">timeout</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">leader 等待  requester(s) 接受 PAXOS 更新的时间，出于同样的目的此值也用于 PAXOS 恢复阶段。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">10.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">paxos</span> <span class="pre">propose</span> <span class="pre">interval</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">提议更新之前收集本时间段的更新。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">1.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">paxos</span> <span class="pre">min</span> <span class="pre">wait</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">经过一段不活跃时间后，收集更新的最小等待时间。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">0.05</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">paxos</span> <span class="pre">trim</span> <span class="pre">tolerance</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">修复前容忍的其他提议数量。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">30</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">paxos</span> <span class="pre">trim</span> <span class="pre">disabled</span> <span class="pre">max</span> <span class="pre">versions</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">允许不修复就通过的最大版本数。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">100</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">lease</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器版本租期（秒）。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">5</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">lease</span> <span class="pre">renew</span> <span class="pre">interval</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器 leader （头领）刷新其他监视器租期的间隔。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">3</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">lease</span> <span class="pre">ack</span> <span class="pre">timeout</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">leader 在等到 providers （随从）确认延长租期前等待的时间。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">10.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">min</span> <span class="pre">osdmap</span> <span class="pre">epochs</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">一直保存的 OSD 图元素最小数量。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">500</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">max</span> <span class="pre">pgmap</span> <span class="pre">epochs</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器应该一直保存的 PG 图元素最大数量。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">500</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">max</span> <span class="pre">log</span> <span class="pre">epochs</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器应该保留的最大日志数量。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">500</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="slurp">
<h3>Slurp<a class="headerlink" href="#slurp" title="Permalink to this headline">¶</a></h3>
<p>在 Ceph 0.58 及之前版本中，当 Paxos 服务偏差的版本数大于某值时，就会触发 <cite>slurp</cite> 机制，它会和法定人数 leader 建立一个连接并获取 leader 拥有的每个版本，以同步每个有偏差的服务。 Ceph 0.59 及后续版本的 slurp 机制取消了，因为所有服务共享一个 Paxos 例程。</p>
<p class="deprecated">
<span class="versionmodified">Deprecated since version 0.58.</span></p>
<p><tt class="docutils literal"><span class="pre">paxos</span> <span class="pre">max</span> <span class="pre">join</span> <span class="pre">drift</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">在我们首次同步监视器数据存储前， Paxos 迭代的最大数量。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">10</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">slurp</span> <span class="pre">timeout</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器进程终止后、自举前，要等待多长时间才开始发出显式修复通告。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">10.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">slurp</span> <span class="pre">bytes</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">显式修复消息尺寸限制。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">256</span> <span class="pre">*</span> <span class="pre">1024</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="index-11">
<span id="id14"></span><h3>时钟<a class="headerlink" href="#index-11" title="Permalink to this headline">¶</a></h3>
<p>Ceph 的守护进程会相互传递关键消息，这些消息必须在达到超时阀值前处理掉。如果 Ceph 监视器时钟不同步，就可能出现多种异常情况。例如：</p>
<ul class="simple">
<li>守护进程忽略了收到的消息（如时间戳过时了）</li>
<li>消息未及时收到时，超时触发得太快或太晚。</li>
</ul>
<p>详情见<a class="reference internal" href="#id13">监视器存储同步</a>和 <a class="reference internal" href="#slurp">Slurp</a> 。</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">你<strong>应该</strong>在所有监视器主机上安装 NTP 以确保监视器集群的时钟同步。</p>
</div>
<p>时钟漂移即使尚未造成损坏也能被 NTP 感知， Ceph 的时钟漂移或时钟偏差警告即使在 NTP 同步水平合理时也会被触发。提高时钟漂移值有时候尚可容忍，然而很多因素（像载荷、网络延时、覆盖默认超时值和<a class="reference internal" href="#id13">监视器存储同步</a>选项）都能在不降低 Paxos 保证级别的情况下影响可接受的时钟漂移水平。</p>
<p>Ceph 提供了下列这些可调选项，让你自己琢磨可接受的值。</p>
<p><tt class="docutils literal"><span class="pre">clock</span> <span class="pre">offset</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">时钟可以漂移多少，详情见 <tt class="docutils literal"><span class="pre">Clock.cc</span></tt> 。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">0</span></tt></td>
</tr>
</tbody>
</table>
<p class="deprecated">
<span class="versionmodified">Deprecated since version 0.58.</span></p>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">tick</span> <span class="pre">interval</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器的心跳间隔，单位为秒。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">5</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">clock</span> <span class="pre">drift</span> <span class="pre">allowed</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器间允许的时钟漂移量</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">.050</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">clock</span> <span class="pre">drift</span> <span class="pre">warn</span> <span class="pre">backoff</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">时钟偏移警告的退避指数。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">5</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">timecheck</span> <span class="pre">interval</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">和 leader 的时间偏移检查（时钟漂移检查）。单位为秒。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Float</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">300.0</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id15">
<h3>客户端<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">client</span> <span class="pre">hung</span> <span class="pre">interval</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">客户端每 <tt class="docutils literal"><span class="pre">N</span></tt> 秒尝试一个新监视器，直到它建立连接。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">3.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">client</span> <span class="pre">ping</span> <span class="pre">interval</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">客户端每 <tt class="docutils literal"><span class="pre">N</span></tt> 秒 ping 一次监视器。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">10.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">client</span> <span class="pre">max</span> <span class="pre">log</span> <span class="pre">entries</span> <span class="pre">per</span> <span class="pre">message</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">某监视器为每客户端生成的最大日志条数。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">1000</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">client</span> <span class="pre">bytes</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">内存中允许存留的客户端消息数量（字节数）。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">64-bit Integer Unsigned</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">100ul</span> <span class="pre">&lt;&lt;</span> <span class="pre">20</span></tt></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id16">
<h2>杂项<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">max</span> <span class="pre">osd</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">集群允许的最大 OSD 数量。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">10000</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">globalid</span> <span class="pre">prealloc</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">为集群预分配的全局 ID 数量。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">100</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">sync</span> <span class="pre">fs</span> <span class="pre">threshold</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">数量达到设定值时和文件系统同步， 0 为禁用。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">32-bit Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">5</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">subscribe</span> <span class="pre">interval</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">同步的刷新间隔（秒），同步机制允许获取集群运行图和日志信息。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">300</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">stat</span> <span class="pre">smooth</span> <span class="pre">intervals</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">Ceph 将平滑最后 <tt class="docutils literal"><span class="pre">N</span></tt> 个归置组图的统计信息。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">2</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">probe</span> <span class="pre">timeout</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">监视器自举无效，搜寻节点前等待的时间。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Double</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">2.0</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">daemon</span> <span class="pre">bytes</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">给元数据服务器和 OSD 的消息使用的内存空间（字节）。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">64-bit Integer Unsigned</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">400ul</span> <span class="pre">&lt;&lt;</span> <span class="pre">20</span></tt></td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">mon</span> <span class="pre">max</span> <span class="pre">log</span> <span class="pre">entries</span> <span class="pre">per</span> <span class="pre">event</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">描述:</th><td class="field-body">每个事件允许的最大日志条数。</td>
</tr>
<tr class="field-even field"><th class="field-name">类型:</th><td class="field-body">Integer</td>
</tr>
<tr class="field-odd field"><th class="field-name">默认值:</th><td class="field-body"><tt class="docutils literal"><span class="pre">4096</span></tt></td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/intro/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start/">安装（快速）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/">安装（手动）</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Ceph 存储集群</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../">配置</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../filesystem-recommendations/">硬盘和文件系统</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ceph-conf/">配置 Ceph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../network-config-ref/">网络选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auth-config-ref/">认证选项</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">监视器选项</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#index-0">背景</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#index-1">集群运行图</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-2">监视器法定人数</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-3">一致性</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-4">初始化监视器</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#index-5">监视器的配置</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id8">最小配置</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id">集群 ID</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-6">初始成员</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-7">数据</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-8">存储容量</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-9">心跳</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-10">监视器存储同步</a></li>
<li class="toctree-l5"><a class="reference internal" href="#slurp">Slurp</a></li>
<li class="toctree-l5"><a class="reference internal" href="#index-11">时钟</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id15">客户端</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id16">杂项</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mon-osd-interaction/">心跳选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../osd-config-ref/">OSD 选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../filestore-config-ref/">filestore 选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../keyvaluestore-config-ref/">键/值存储选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../journal-ref/">日志选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pool-pg-config-ref/">存储池、归置组和 CRUSH 选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ms-ref/">消息传递选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../general-config-ref/">常规选项</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../deployment/">部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/">运维</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/">手册页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting/">故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/">APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rbd/rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev/">开发文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Ceph 版本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Ceph 术语</a></li>
</ul>


<!-- ugly kludge to make genindex look like it's part of the toc -->
<ul style="margin-top: -10px"><li class="toctree-l1"><a class="reference internal" href="../../../genindex/">Index</a></li></ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../mon-osd-interaction/" title="监视器与 OSD 交互的配置"
             >next</a> |</li>
        <li class="right" >
          <a href="../auth-config-ref/" title="Cephx 配置参考"
             >previous</a> |</li>
        <li><a href="../../../">Ceph Documentation</a> &raquo;</li>
          <li><a href="../../" >Ceph 存储集群</a> &raquo;</li>
          <li><a href="../" >配置</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2014, Inktank Storage, Inc. and contributors. Licensed under Creative Commons BY-SA.
    </div>
  </body>
</html>